<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿè© é­”åŠ› - å¸‚å ´æŸ¥åƒ¹å™¨</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #f5f0e8;
            --bg-card: #fffbf5;
            --bg-card-hover: #fff8ec;
            --border: #e0d5c5;
            --text-primary: #4a3f35;
            --text-secondary: #8b7355;
            --accent-gold: #d4a024;
            --accent-blue: #5b8cb8;
            --accent-green: #5a9a5a;
            --accent-red: #c75050;
            --accent-purple: #9068b0;
            --server-1: #d35d5d;
            --server-2: #5a9a5a;
            --server-3: #5b8cb8;
            --shadow: 0 4px 16px rgba(74,63,53,0.12);
            --radius: 8px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Noto Sans TC', -apple-system, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            font-size: 16px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .header h1 {
            font-size: 1.75rem;
            font-weight: 700;
            background: linear-gradient(135deg, #b8860b, #8b4513);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header .badge {
            background: var(--accent-purple);
            color: #fff;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* Search Panel */
        .search-panel {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
        }

        .search-row {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: flex-end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-group label {
            font-size: 0.95rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .form-group.grow {
            flex: 1;
            min-width: 200px;
        }

        .exchange-rate-group input {
            width: 100px;
        }

        input[type="text"], input[type="number"], select {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 10px 14px;
            color: var(--text-primary);
            font-size: 1.05rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.2);
        }

        button {
            background: linear-gradient(135deg, #b48a61, #8b6b4a);
            border: none;
            border-radius: var(--radius);
            padding: 12px 24px;
            color: #fff;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.15s, box-shadow 0.15s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139,107,74,0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        button.secondary {
            background: #fff;
            border: 2px solid #b48a61;
            color: #6b4c2a;
        }

        button.secondary:hover {
            background: #f5e6d3;
            border-color: #8b6b4a;
            box-shadow: none;
        }

        /* Quick Tags */
        .quick-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .quick-tag {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .quick-tag:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
        }

        .quick-tag .remove {
            color: var(--accent-red);
            font-weight: bold;
            opacity: 0.6;
        }

        .quick-tag .remove:hover {
            opacity: 1;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px;
            text-align: center;
        }

        .stat-card .label {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .stat-card .value {
            font-size: 1.2rem;
            font-weight: 700;
            line-height: 1.4;
        }

        .stat-card .value.gold { color: var(--accent-gold); }
        .stat-card .value.green { color: var(--accent-green); }
        .stat-card .value.blue { color: var(--accent-blue); }
        .stat-card .value.red { color: var(--accent-red); }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 4px;
            margin-bottom: 16px;
            background: var(--bg-card);
            padding: 4px;
            border-radius: var(--radius);
            width: fit-content;
        }

        .tab {
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.2s;
        }

        .tab:hover {
            color: var(--text-primary);
        }

        .tab.active {
            background: #b48a61;
            color: #fff;
        }

        /* Tables */
        .table-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .table-scroll {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        th {
            background: var(--bg-dark);
            padding: 14px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border);
            white-space: nowrap;
            cursor: pointer;
            user-select: none;
        }

        th:hover {
            color: var(--accent-blue);
        }

        th .sort-icon {
            margin-left: 4px;
            opacity: 0.5;
        }

        th .sort-icon.active {
            opacity: 1;
            color: var(--accent-gold);
        }

        td {
            padding: 14px 12px;
            border-bottom: 1px solid var(--border);
            font-size: 1rem;
        }

        /* å›ºå®šç¬¬ä¸€æ¬„ï¼ˆç‰©å“åç¨±ï¼‰ */
        th:first-child,
        td:first-child {
            position: sticky;
            left: 0;
            background: var(--bg-card);
            z-index: 2;
            border-right: 2px solid var(--border);
        }

        th:first-child {
            background: var(--bg-dark);
            z-index: 3;
        }

        tr:hover td {
            background: var(--bg-card-hover);
        }

        tr:hover td:first-child {
            background: var(--bg-card-hover);
        }

        tr:last-child td {
            border-bottom: none;
        }

        /* Server Badge */
        .server-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-right: 6px;
        }

        .server-badge.s1 { background: var(--server-1); color: #fff; }
        .server-badge.s2 { background: var(--server-2); color: #fff; }
        .server-badge.s3 { background: var(--server-3); color: #fff; }

        /* æ”¹é€ åœ–ç­‰ç´šæ¨™ç±¤ */
        .grade-normal {
            background: #D2691E;
            color: #fff;
            padding: 2px 10px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-left: 8px;
            display: inline-block;
            vertical-align: middle;
        }
        .grade-silver {
            background: #808080;
            color: #fff;
            padding: 2px 10px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-left: 8px;
            display: inline-block;
            vertical-align: middle;
        }
        .grade-gold {
            background: #DAA520;
            color: #fff;
            padding: 2px 10px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-left: 8px;
            display: inline-block;
            vertical-align: middle;
        }

        /* é‡ä¾†çš„ç¨®å­ BP æ¨™ç±¤ */
        .bp-plus {
            background: #27ae60;
            color: #fff;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 4px;
        }
        .bp-minus {
            background: #e74c3c;
            color: #fff;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 4px;
        }

        /* å¯µç‰©æ¨™ç±¤ */
        .pet-lv {
            background: #3498db;
            color: #fff;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 6px;
        }
        
        .pet-trans {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: #fff;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 4px;
        }
        
        .pet-slot {
            background: #27ae60;
            color: #fff;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 4px;
        }

        /* Price Display */
        .price {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
        }

        .price.coin { color: var(--accent-gold); }
        .price.crystal { color: var(--accent-purple); }

        .converted {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-left: 8px;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .loading .spinner {
            display: inline-block;
            width: 32px;
            height: 32px;
            border: 3px solid var(--border);
            border-top-color: var(--accent-blue);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-bottom: 12px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state .icon {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Inline Chart Container (åœ¨è¡¨æ ¼è¡Œå…§) */
        .inline-chart-container {
            background: var(--bg-card);
            padding: 16px;
            border-top: 2px solid var(--border);
        }

        .inline-chart-container .chart-title {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .inline-chart-wrapper {
            position: relative;
            height: 250px;
        }

        .chart-row td {
            padding: 0 !important;
        }

        /* History Summary */
        .history-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
        }

        .summary-card h3 {
            font-size: 1rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .summary-row:last-child {
            border-bottom: none;
        }

        .summary-row .label {
            color: var(--text-secondary);
        }

        .summary-row .value {
            font-weight: 600;
        }

        /* Responsive - å¹³æ¿ */
        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }

            .header {
                flex-wrap: wrap;
            }

            .header h1 {
                font-size: 1.25rem;
            }

            .header a {
                font-size: 0.75rem;
                margin-left: 0;
                width: 100%;
                margin-top: 8px;
            }

            .search-row {
                flex-direction: column;
            }

            .form-group {
                width: 100%;
            }

            .form-group.grow {
                width: 100%;
            }

            .search-row button {
                width: 100%;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .tabs {
                width: 100%;
            }

            .tab {
                flex: 1;
                text-align: center;
                padding: 10px 12px;
                font-size: 0.9rem;
            }

            /* è¡¨æ ¼æ°´å¹³æ»¾å‹• */
            .table-container {
                overflow: hidden;
            }

            .table-scroll {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            table {
                min-width: 800px;
            }
        }

        /* Responsive - æ‰‹æ©Ÿ */
        @media (max-width: 480px) {
            .container {
                padding: 8px;
            }

            .header h1 {
                font-size: 1.1rem;
            }

            .header .badge {
                font-size: 0.65rem;
                padding: 3px 8px;
            }

            .search-panel {
                padding: 12px;
            }

            .form-group label {
                font-size: 0.85rem;
            }

            input[type="text"], input[type="number"], select {
                padding: 10px 12px;
                font-size: 1rem;
            }

            button {
                padding: 12px 16px;
                font-size: 1rem;
            }

            .quick-tags {
                gap: 6px;
            }

            .quick-tag {
                padding: 6px 12px;
                font-size: 0.9rem;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
                gap: 8px;
            }

            .stat-card {
                padding: 12px 8px;
            }

            .stat-card .label {
                font-size: 0.95rem;
                font-weight: 600;
            }

            .stat-card .value {
                font-size: 1.0rem;
                line-height: 1.3;
            }

            .tabs {
                padding: 3px;
            }

            .tab {
                padding: 8px 10px;
                font-size: 0.85rem;
            }

            td, th {
                padding: 10px 8px;
                font-size: 0.9rem;
            }

            .price {
                font-size: 0.9rem;
            }

            .converted {
                display: block;
                margin-left: 0;
                margin-top: 2px;
                font-size: 0.8rem;
            }

            .grade-normal, .grade-silver, .grade-gold {
                font-size: 0.7rem;
                padding: 1px 6px;
                margin-left: 4px;
            }

            .bp-plus, .bp-minus {
                font-size: 0.65rem;
                padding: 1px 4px;
                margin-left: 2px;
            }

            .server-badge {
                font-size: 0.65rem;
                padding: 1px 5px;
            }

            .chart-container {
                padding: 12px;
            }

            .chart-wrapper {
                height: 250px;
            }

            .empty-state {
                padding: 40px 16px;
            }

            .empty-state .icon {
                font-size: 2.5rem;
            }
        }

        /* Tooltip */
        .tooltip {
            position: relative;
        }

        .tooltip::after {
            content: attr(data-tip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-dark);
            border: 1px solid var(--border);
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }

        .tooltip:hover::after {
            opacity: 1;
        }

        /* Highlight row */
        .highlight {
            animation: highlight 1.5s ease-out;
        }

        @keyframes highlight {
            0% { background: rgba(180, 138, 97, 0.3); }
            100% { background: transparent; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
            50% { transform: scale(1.02); box-shadow: 0 0 15px 5px rgba(231, 76, 60, 0.4); }
        }

        /* Equipment Panel */
        .equipment-panel {
            position: fixed;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1000;
            display: flex;
            align-items: stretch;
        }

        .equipment-toggle {
            writing-mode: vertical-rl;
            text-orientation: mixed;
            padding: 16px 10px;
            border-radius: 8px 0 0 8px;
            background: linear-gradient(135deg, #b48a61, #8b6b4a);
            border: none;
            color: #fff;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: -2px 0 8px rgba(0,0,0,0.15);
        }

        .equipment-toggle:hover {
            background: linear-gradient(135deg, #c49a71, #9b7b5a);
        }

        .equipment-content {
            width: 0;
            overflow: hidden;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-right: none;
            border-radius: 8px 0 0 8px;
            box-shadow: -4px 0 16px rgba(0,0,0,0.1);
            transition: width 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .equipment-panel.open .equipment-content {
            width: 320px;
        }

        .equipment-header {
            padding: 16px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-dark);
        }

        .equipment-header h3 {
            margin: 0 0 12px 0;
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        .equipment-filters {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .equipment-filters select,
        .equipment-filters input {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .equipment-list {
            flex: 1;
            overflow-y: auto;
            max-height: 60vh;
        }

        .equipment-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px 12px;
            border-bottom: 1px solid var(--border);
            transition: background 0.2s;
        }

        .equipment-item:hover {
            background: var(--bg-card-hover);
        }

        .equipment-info {
            flex: 1;
            min-width: 0;
        }

        .equipment-row {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .equipment-main {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .equipment-name {
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.95rem;
            flex-shrink: 0;
        }

        .equipment-level {
            color: var(--accent-blue);
            font-size: 0.85rem;
            font-weight: 600;
            white-space: nowrap;
        }

        .equipment-stats {
            color: #8bc34a;
            font-size: 0.75rem;
        }

        .equipment-actions {
            display: flex;
            gap: 6px;
            flex-shrink: 0;
        }

        .equipment-actions button {
            padding: 6px 10px;
            font-size: 0.8rem;
            border-radius: 4px;
        }

        .equipment-actions .btn-search {
            background: var(--accent-blue);
        }

        .equipment-actions .btn-add {
            background: var(--accent-green);
            padding: 6px 8px;
        }

        .equipment-empty {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }

        /* Mobile responsive for equipment panel */
        @media (max-width: 768px) {
            .equipment-panel {
                top: auto;
                bottom: 20px;
                transform: none;
            }

            .equipment-panel.open .equipment-content {
                width: 280px;
            }

            .equipment-list {
                max-height: 50vh;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <!-- Header -->
    <div class="header">
        <h1>â­ æ˜Ÿè© é­”åŠ› å¸‚å ´æŸ¥åƒ¹å™¨</h1>
        <span class="badge">v2.0</span>
        <a href="https://member.starcg.net/market.php" target="_blank" 
           style="margin-left:auto; color:var(--text-secondary); font-size:0.9rem; text-decoration:none;">
            ğŸ“‹ å®˜æ–¹å¸‚å ´
        </a>
    </div>

    <!-- Search Panel -->
    <div class="search-panel">
        <div class="search-row">
            <div class="form-group grow">
                <label>ğŸ” æœå°‹ç‰©å“/å¯µç‰©åç¨±</label>
                <input type="text" id="searchInput" placeholder="è¼¸å…¥åç¨±é—œéµå­—...">
            </div>
            <div class="form-group">
                <label>ğŸ’° å¹£ç¨®</label>
                <select id="currencyFilter">
                    <option value="all" selected>å…¨éƒ¨</option>
                    <option value="0">é­”å¹£ ğŸ’°</option>
                    <option value="1">é­”æ™¶ ğŸ’</option>
                </select>
            </div>
            <div class="form-group">
                <label>ğŸ–¥ï¸ åˆ†æµ</label>
                <select id="serverFilter">
                    <option value="all" selected>å…¨éƒ¨</option>
                    <option value="1">S1</option>
                    <option value="2">S2</option>
                    <option value="3">S3</option>
                </select>
            </div>
            <div class="form-group">
                <label>ğŸ›¡ï¸ è€ä¹…</label>
                <select id="durabilityFilter">
                    <option value="full" selected>è€ä¹…æ»¿</option>
                    <option value="all">å…¨éƒ¨</option>
                </select>
            </div>
            <div class="form-group exchange-rate-group">
                <label>ğŸ’± åŒ¯ç‡ (é­”å¹£:é­”æ™¶)</label>
                <input type="number" id="exchangeRate" value="275" min="1">
            </div>
            <div class="form-group">
                <button id="searchBtn">ğŸ” æœå°‹å¸‚å ´</button>
            </div>
            <div class="form-group">
                <button id="historyBtn" class="secondary">ğŸ“ˆ 72Hæ­·å²æˆäº¤</button>
            </div>
        </div>

        <!-- Quick Tags -->
        <div class="quick-tags" id="quickTags"></div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid" id="statsGrid" style="display: none;">
        <div class="stat-card">
            <div class="label">ğŸ“¦ åœ¨å”®æ•¸é‡</div>
            <div class="value blue" id="statCount">0</div>
        </div>
        <div class="stat-card">
            <div class="label">ğŸ’° æœ€ä½åƒ¹</div>
            <div class="value green" id="statMinPrice">-</div>
        </div>
        <div class="stat-card">
            <div class="label">ğŸ“Š ä¸­ä½åƒ¹</div>
            <div class="value gold" id="statAvgPrice">-</div>
        </div>
        <div class="stat-card">
            <div class="label">ğŸ“ˆ æœ€é«˜åƒ¹</div>
            <div class="value red" id="statMaxPrice">-</div>
        </div>
    </div>

    <!-- Tabs -->
    <div class="tabs" id="tabsContainer" style="display: none;">
        <div class="tab active" data-tab="market">ğŸª å¸‚å ´æ”¤ä½</div>
        <div class="tab" data-tab="history">ğŸ“œ æ­·å²æˆäº¤</div>
    </div>

    <!-- Loading -->
    <div class="loading" id="loading" style="display: none;">
        <div class="spinner"></div>
        <div>æ­£åœ¨è¼‰å…¥è³‡æ–™...</div>
    </div>

    <!-- Market Table -->
    <div class="table-container" id="marketSection" style="display: none;">
        <div class="table-scroll">
            <table id="marketTable">
                <thead>
                    <tr>
                        <th data-sort="item">ç‰©å“åç¨±</th>
                        <th data-sort="price">åƒ¹æ ¼ <span class="sort-icon active">â–²</span></th>
                        <th>åˆ†æµ/åœ°é»</th>
                        <th>æ”¤ä½åç¨±</th>
                        <th data-sort="durability">è€ä¹…</th>
                        <th data-sort="attack">æ”»æ“Š</th>
                        <th data-sort="defence">é˜²ç¦¦</th>
                        <th data-sort="agility">æ•æ·</th>
                        <th>æ•¸é‡</th>
                    </tr>
                </thead>
                <tbody id="marketBody"></tbody>
            </table>
        </div>
    </div>

    <!-- History Section -->
    <div id="historySection" style="display: none;">
        <div class="history-summary" id="historySummary"></div>
        
        <div class="table-container">
            <div class="table-scroll">
                <table id="historyTable">
                    <thead>
                        <tr>
                            <th>ç‰©å“åç¨±</th>
                            <th>ğŸ’° æœ€ä½</th>
                            <th>ğŸ’° ä¸­ä½</th>
                            <th>ğŸ’° æœ€é«˜</th>
                            <th>ğŸ’ æœ€ä½</th>
                            <th>ğŸ’ ä¸­ä½</th>
                            <th>ğŸ’ æœ€é«˜</th>
                            <th>æˆäº¤æ•¸</th>
                            <th>èµ°å‹¢</th>
                        </tr>
                    </thead>
                    <tbody id="historyBody"></tbody>
                </table>
            </div>
        </div>

        </div>

    <!-- Empty State -->
    <div class="empty-state" id="emptyState">
        <div class="icon">ğŸ”</div>
        <div>è¼¸å…¥ç‰©å“åç¨±é–‹å§‹æœå°‹</div>
        <div style="margin-top: 8px; font-size: 0.85rem;">æ”¯æ´æ¨¡ç³Šæœå°‹ï¼Œä¾‹å¦‚ï¼šé¢åŒ…ã€å£½å–œã€è½‰è›‹</div>
    </div>
</div>

<!-- Equipment Panel -->
<div class="equipment-panel" id="equipmentPanel">
    <button class="equipment-toggle" onclick="toggleEquipmentPanel()">ğŸ“¦ è£å‚™åˆ—è¡¨</button>
    <div class="equipment-content">
        <div class="equipment-header">
            <h3>ğŸ“¦ è£å‚™è³‡æ–™åº«</h3>
            <div class="equipment-filters">
                <select id="equipmentCategoryFilter" onchange="filterEquipments()">
                    <option value="all">å…¨éƒ¨ç¨®é¡</option>
                </select>
                <input type="text" id="equipmentSearchInput" placeholder="æœå°‹è£å‚™åç¨±..." oninput="filterEquipments()">
            </div>
        </div>
        <div class="equipment-list" id="equipmentList"></div>
    </div>
</div>

<script>
/* ========================================
   å…¨åŸŸè®Šæ•¸
======================================== */
// CORS ä»£ç†
const CORS_PROXY = 'https://corsproxy.io/?';

// è£å‚™è³‡æ–™åº«
const EQUIPMENT_DATA = [
    // åŠ
    {category:'åŠ',level:1,name:'é•·åŠ',stats:'æ”»æ“Š+12~+24'},
    {category:'åŠ',level:1,name:'é—ŠåŠ',stats:'æ”»æ“Š+18~+36'},
    {category:'åŠ',level:2,name:'çªåˆºåŠ',stats:'æ”»æ“Š+26~+48'},
    {category:'åŠ',level:2,name:'ç«èˆŒåŠ',stats:'æ”»æ“Š+33~+60'},
    {category:'åŠ',level:3,name:'éºµåŒ…åŠ',stats:'æ”»æ“Š+43~+75'},
    {category:'åŠ',level:3,name:'é›™æ‰‹åŠ',stats:'æ”»æ“Š+50~+84'},
    {category:'åŠ',level:4,name:'é›™åˆƒé•·åŠ',stats:'æ”»æ“Š+62~+96'},
    {category:'åŠ',level:4,name:'é–åˆƒåŠ',stats:'æ”»æ“Š+70~+108'},
    {category:'åŠ',level:5,name:'æ ¼é¬¥åŠ',stats:'æ”»æ“Š+84~+120'},
    {category:'åŠ',level:5,name:'é•·é”åŠ',stats:'æ”»æ“Š+92~+132'},
    {category:'åŠ',level:5,name:'é»‘ä½œå¤ªåˆ€',stats:'æ”»æ“Š+93~+129 æ•æ·+1~+5'},
    {category:'åŠ',level:6,name:'è±¬ç‰™åŠ',stats:'æ”»æ“Š+108~+144'},
    {category:'åŠ',level:6,name:'é›™åˆƒé—ŠåŠ',stats:'æ”»æ“Š+117~+156'},
    {category:'åŠ',level:7,name:'å·¨åŠ',stats:'æ”»æ“Š+125~+170'},
    {category:'åŠ',level:7,name:'é•·è»åˆ€',stats:'æ”»æ“Š+135~+180'},
    {category:'åŠ',level:7,name:'æ°´é¾ä¹‹åŠ',stats:'æ”»æ“Š+210 æ•æ·+5'},
    {category:'åŠ',level:8,name:'è­·èº«çŸ­åŠ',stats:'æ”»æ“Š+225~+230'},
    {category:'åŠ',level:8,name:'ç´°æŸ„çŸ­åŠ',stats:'æ”»æ“Š+153~+204'},
    {category:'åŠ',level:8,name:'é•·è»åˆ€+',stats:'æ”»æ“Š+90~+180'},
    {category:'åŠ',level:9,name:'ç´°åˆƒé‡åŠ',stats:'æ”»æ“Š+182~+228'},
    {category:'åŠ',level:9,name:'å‰›ç¡¬å·¨åŠ',stats:'æ”»æ“Š+185'},
    {category:'åŠ',level:10,name:'é’é¾åˆ€',stats:'æ”»æ“Š+204~+240'},
    {category:'åŠ',level:10,name:'æ›²åˆ€',stats:'æ”»æ“Š+250 æ•æ·+1'},
    {category:'åŠ',level:11,name:'å½å‹¾åŠ',stats:'æ”»æ“Š+239~+250'},
    {category:'åŠ',level:11,name:'å‰›æ¯…',stats:'æ”»æ“Š+285~+300 é–ƒèº²+20'},
    // æ–§
    {category:'æ–§',level:1,name:'æ‰‹æ–§',stats:'æ”»æ“Š+15~+29 å¿…æ®º+18'},
    {category:'æ–§',level:1,name:'å‹‡æ°£ä¹‹æ–§',stats:'æ”»æ“Š+22~+44 å¿…æ®º+18'},
    {category:'æ–§',level:2,name:'å¯¬æ‰‹æ–§',stats:'æ”»æ“Š+32~+58 å¿…æ®º+18'},
    {category:'æ–§',level:2,name:'æˆ°é¬¥æ‰‹æ–§',stats:'æ”»æ“Š+40~+73 å¿…æ®º+18'},
    {category:'æ–§',level:3,name:'æ ¼é¬¥æ‰‹æ–§',stats:'æ”»æ“Š+52~+87 å¿…æ®º+18'},
    {category:'æ–§',level:3,name:'é‹¼æ–§',stats:'æ”»æ“Š+61~+102 å¿…æ®º+18'},
    {category:'æ–§',level:4,name:'é•·æˆ°æ–§',stats:'æ”»æ“Š+75~+116 å¿…æ®º+18'},
    {category:'æ–§',level:4,name:'é›™åˆƒæ–§',stats:'æ”»æ“Š+85~+131 å¿…æ®º+18'},
    {category:'æ–§',level:5,name:'é‰¤çˆªæ–§',stats:'æ”»æ“Š+102~+145 å¿…æ®º+18'},
    {category:'æ–§',level:5,name:'é—Šåˆƒæ–§',stats:'æ”»æ“Š+112~+160 å¿…æ®º+18'},
    {category:'æ–§',level:5,name:'é‘½ä¿é›·æ ¼ä¹‹æ–§',stats:'æ”»æ“Š+100~+168 å¿…æ®º+18'},
    {category:'æ–§',level:6,name:'å½æœˆå¤§æˆ°æ–§',stats:'æ”»æ“Š+131~+174 å¿…æ®º+18'},
    {category:'æ–§',level:6,name:'å¤§å‹é—Šåˆƒæ–§',stats:'æ”»æ“Š+142~+189 å¿…æ®º+18'},
    {category:'æ–§',level:7,name:'å¤§å‹é›™åˆƒæ–§',stats:'æ”»æ“Š+164~+220 å¿…æ®º+18'},
    {category:'æ–§',level:7,name:'è¶…å¤§çš‡å¸æ–§',stats:'æ”»æ“Š+120~+145 å¿…æ®º+36'},
    {category:'æ–§',level:7,name:'æ°´é¾ä¹‹æ–§',stats:'æ”»æ“Š+220 é˜²ç¦¦+25 å¿…æ®º+18'},
    {category:'æ–§',level:8,name:'æ–°æœˆæ–§',stats:'æ”»æ“Š+174~+232 å¿…æ®º+18'},
    {category:'æ–§',level:8,name:'ç±³è«¾é™¶æ–¯æˆ°æ–§',stats:'æ”»æ“Š+200~+245 å¿…æ®º+18'},
    {category:'æ–§',level:8,name:'å¤§å‹é›™åˆƒæ–§+',stats:'æ”»æ“Š+168~+225 å¿…æ®º+18'},
    {category:'æ–§',level:9,name:'è–„åˆƒé‰¤çˆªæ–§',stats:'æ”»æ“Š+221~+276 å¿…æ®º+18'},
    {category:'æ–§',level:9,name:'å½æœˆé•·æŸ„æ–§',stats:'æ”»æ“Š+221~+276 å¿…æ®º+21'},
    {category:'æ–§',level:10,name:'é‡‘å±¬é‡æ–§',stats:'æ”»æ“Š+259~+305 å¿…æ®º+18'},
    {category:'æ–§',level:10,name:'è™•åˆ‘æ–§',stats:'æ”»æ“Š+305~+310 å¿…æ®º+18'},
    {category:'æ–§',level:11,name:'é«˜é€Ÿæ–§',stats:'æ”»æ“Š+230~+249 å¿…æ®º+12'},
    {category:'æ–§',level:11,name:'é‡æ“Šæ–§',stats:'æ”»æ“Š+295~+331 å¿…æ®º+36'},
    // æ§
    {category:'æ§',level:1,name:'çŸ­çŸ›',stats:'æ”»æ“Š+10~+20 åæ“Š+6'},
    {category:'æ§',level:1,name:'æ”»åŸæ§',stats:'æ”»æ“Š+15~+30 åæ“Š+6'},
    {category:'æ§',level:2,name:'åˆºæ§',stats:'æ”»æ“Š+22~+40 åæ“Š+6'},
    {category:'æ§',level:2,name:'é‡‘å±¬æ§',stats:'æ”»æ“Š+28~+50 åæ“Š+6'},
    {category:'æ§',level:3,name:'é•·æŸ„å½æ§',stats:'æ”»æ“Š+36~+60 åæ“Š+6'},
    {category:'æ§',level:3,name:'é•·æŸ„å°–æ§',stats:'æ”»æ“Š+42~+70 åæ“Š+6'},
    {category:'æ§',level:4,name:'ç©—æ§',stats:'æ”»æ“Š+52~+80 åæ“Š+6'},
    {category:'æ§',level:4,name:'é›™å‰æˆŸ',stats:'æ”»æ“Š+59~+90 åæ“Š+6'},
    {category:'æ§',level:5,name:'è­·è¡›æ§',stats:'æ”»æ“Š+70~+100 åæ“Š+6'},
    {category:'æ§',level:5,name:'é¨å£«æ§',stats:'æ”»æ“Š+77~+110 åæ“Š+6'},
    {category:'æ§',level:5,name:'åƒæœˆåˆ€',stats:'æ”»æ“Š+87~+126 é˜²ç¦¦+1~+5 åæ“Š+8'},
    {category:'æ§',level:6,name:'å¤§ç æ§',stats:'æ”»æ“Š+90~+120 åæ“Š+6'},
    {category:'æ§',level:6,name:'é•·å°–æ§',stats:'æ”»æ“Š+98~+130 åæ“Š+6'},
    {category:'æ§',level:7,name:'è æ§',stats:'æ”»æ“Š+105~+140 åæ“Š+6'},
    {category:'æ§',level:7,name:'é›™åˆƒæ§',stats:'æ”»æ“Š+120~+125 åæ“Š+12'},
    {category:'æ§',level:7,name:'æ°´é¾ä¹‹æ§',stats:'æ”»æ“Š+140 æ•æ·+50 å¿…æ®º+12'},
    {category:'æ§',level:8,name:'é—Šåˆƒæ§',stats:'æ”»æ“Š+120~+160 åæ“Š+6'},
    {category:'æ§',level:8,name:'æ±æ–¹é•·åˆºé—',stats:'æ”»æ“Š+140 åæ“Š+6'},
    {category:'æ§',level:8,name:'è æ§+',stats:'æ”»æ“Š+110~+148 åæ“Š+5~+7'},
    {category:'æ§',level:9,name:'é‰¤çˆªæ§',stats:'æ”»æ“Š+152~+190 åæ“Š+6'},
    {category:'æ§',level:9,name:'åŸå§‹æ§',stats:'æ”»æ“Š+180~+190 åæ“Š+9'},
    {category:'æ§',level:10,name:'ä¸‰å‰æˆ°æˆŸ',stats:'æ”»æ“Š+179~+210 åæ“Š+6'},
    {category:'æ§',level:10,name:'ç•°å‹æ§',stats:'æ”»æ“Š+225 åæ“Š+1'},
    {category:'æ§',level:11,name:'ç—›æ“Šæ§',stats:'æ”»æ“Š+206~+224 å¿…æ®º+8 åæ“Š+8'},
    {category:'æ§',level:11,name:'ç©¿åˆºæ§',stats:'æ”»æ“Š+200~+252 å‘½ä¸­+15'},
    // å¼“
    {category:'å¼“',level:1,name:'è¼•å‹å¼“',stats:'æ”»æ“Š+11~+22'},
    {category:'å¼“',level:1,name:'å¨åŠ›çŸ­å¼“',stats:'æ”»æ“Š+17~+33'},
    {category:'å¼“',level:2,name:'çŸ­æˆ°å¼“',stats:'æ”»æ“Š+24~+44'},
    {category:'å¼“',level:2,name:'çµå¼“',stats:'æ”»æ“Š+30~+55'},
    {category:'å¼“',level:3,name:'å¼·å¼“',stats:'æ”»æ“Š+40~+66'},
    {category:'å¼“',level:3,name:'æ ¼é¬¥å¼“',stats:'æ”»æ“Š+46~+77'},
    {category:'å¼“',level:4,name:'ç‹™æ“Šå¼“',stats:'æ”»æ“Š+57~+88'},
    {category:'å¼“',level:4,name:'è¶…å¼·ç‹™æ“Šå¼“',stats:'æ”»æ“Š+64~+99'},
    {category:'å¼“',level:5,name:'æ®ºæ‰‹é•·å¼“',stats:'æ”»æ“Š+77~+110'},
    {category:'å¼“',level:5,name:'è¡æ“Šå¼“',stats:'æ”»æ“Š+85~+121'},
    {category:'å¼“',level:5,name:'ç±³æ–¯ç‰¹æ±€ä¹‹å¼“',stats:'æ”»æ“Š+77~+122 é–ƒèº²+1~+3'},
    {category:'å¼“',level:6,name:'å·¨å¼“',stats:'æ”»æ“Š+99~+132'},
    {category:'å¼“',level:6,name:'é•·æ ¼é¬¥å¼“',stats:'æ”»æ“Š+107~+143'},
    {category:'å¼“',level:7,name:'ç ´é‚ªé•·å¼“',stats:'æ”»æ“Š+120~+130 å‘½ä¸­+10 å¿…æ®º+2'},
    {category:'å¼“',level:7,name:'æœˆå…‰é•·å¼“',stats:'æ”»æ“Š+123~+165'},
    {category:'å¼“',level:7,name:'æ°´é¾ä¹‹å¼“',stats:'æ”»æ“Š+165 å¿…æ®º+2 å‘½ä¸­+20'},
    {category:'å¼“',level:8,name:'åŸå§‹çŸ³å¼“',stats:'æ”»æ“Š+170~+187 å‘½ä¸­+15'},
    {category:'å¼“',level:8,name:'é‡å¼¦å¼“',stats:'æ”»æ“Š+140~+187'},
    {category:'å¼“',level:8,name:'æœˆå…‰ä¹‹å¼“+',stats:'æ”»æ“Š+130~+160 å‘½ä¸­+1~+5'},
    {category:'å¼“',level:9,name:'å¹³è¡Œå¼“',stats:'æ”»æ“Š+167~+209'},
    {category:'å¼“',level:9,name:'éˆé­‚ä¹‹å¼“',stats:'æ”»æ“Š+165'},
    {category:'å¼“',level:10,name:'æ‘˜æ˜Ÿä¹‹å¼“',stats:'æ”»æ“Š+196~+231'},
    {category:'å¼“',level:10,name:'é­”å½ˆ',stats:'æ”»æ“Š+195 å‘½ä¸­+5'},
    {category:'å¼“',level:11,name:'èª¿å’Œä¹‹å¼“',stats:'æ”»æ“Š+201~+219 å¿…æ®º+6 é–ƒèº²+10'},
    {category:'å¼“',level:11,name:'æœˆä¹‹å¼“',stats:'æ”»æ“Š+222~+250 é˜²ç¦¦+30 å‘½ä¸­+8'},
    // æ–
    {category:'æ–',level:1,name:'çŸ­æ–',stats:'ç²¾ç¥+4~+5 é­”æ”»+11~+14'},
    {category:'æ–',level:1,name:'æ¬Šæ–',stats:'æ”»æ“Š+5~+10 é­”æ”»+11~+12'},
    {category:'æ–',level:2,name:'å¤§åœ°ä¹‹æ–',stats:'ç²¾ç¥+8~+10 é­”æ”»+42~+48'},
    {category:'æ–',level:2,name:'æ¿€æµæ¬Šæ–',stats:'æ”»æ“Š+11~+20 é­”æ”»+42~+45'},
    {category:'æ–',level:3,name:'é­”ä¹‹æ‰‹æ–',stats:'ç²¾ç¥+10~+15 é­”æ”»+73~+82'},
    {category:'æ–',level:3,name:'é­”ä¹‹æ¬Šæ–',stats:'æ”»æ“Š+19~+30 é­”æ”»+73~+77'},
    {category:'æ–',level:4,name:'è³¢è€…æ‰‹æ–',stats:'ç²¾ç¥+15~+20 é­”æ”»+104~+116'},
    {category:'æ–',level:4,name:'è³¢è€…æ¬Šæ–',stats:'æ”»æ“Š+28~+40 é­”æ”»+104~+110'},
    {category:'æ–',level:5,name:'ç¥ç€æ–',stats:'ç²¾ç¥+20~+25 é­”æ”»+135~+150'},
    {category:'æ–',level:5,name:'ç¥ç€æ¬Šæ–',stats:'æ”»æ“Š+37~+50 é­”æ”»+135~+142'},
    {category:'æ–',level:5,name:'é­”æ™¶ä¹‹æ–',stats:'æ”»æ“Š+38~+51 å›å¾©+1~+6 é­”æ”»+135~+142'},
    {category:'æ–',level:6,name:'å…ƒç´ ä¹‹æ–',stats:'ç²¾ç¥+24~+30 é­”æ”»+166~+184'},
    {category:'æ–',level:6,name:'ç¥è–ä¹‹æ–',stats:'æ”»æ“Š+46~+60 é­”æ”»+166~+175'},
    {category:'æ–',level:7,name:'æ€’éŸ³ä¹‹æ–',stats:'ç²¾ç¥+28~+35 é­”æ”»+197~+218'},
    {category:'æ–',level:7,name:'éš±è€…ä¹‹æ–',stats:'æ”»æ“Š+55~+70 é­”æ”»+197~+207'},
    {category:'æ–',level:7,name:'æ°´é¾ä¹‹æ–',stats:'æ”»æ“Š+70 ç²¾ç¥+35 é­”æ”»+218'},
    {category:'æ–',level:8,name:'å…‰æ˜çŸ­æ–',stats:'ç²¾ç¥+32~+40 é­”æ”»+228~+252'},
    {category:'æ–',level:8,name:'æƒ¡é­”ä¹‹æ–',stats:'æ”»æ“Š+64~+80 é­”æ”»+228~+240'},
    {category:'æ–',level:8,name:'è½é›·æ¬Šæ–+',stats:'æ”»æ“Š+50~+70 ç²¾ç¥+28~+35 é­”æ”»+197~+208'},
    {category:'æ–',level:9,name:'å¤ªé™½çŸ­æ–',stats:'ç²¾ç¥+36~+45 é­”æ”»+259~+286'},
    {category:'æ–',level:9,name:'å¤©ä½¿ä¹‹æ–',stats:'æ”»æ“Š+72~+90 é­”æ”»+259~+272'},
    {category:'æ–',level:10,name:'è–è€…ä¹‹æ–',stats:'ç²¾ç¥+43~+50 é­”æ”»+290~+320'},
    {category:'æ–',level:10,name:'æ˜Ÿå±‘çŸ­æ–',stats:'æ”»æ“Š+85~+100 é­”æ”»+290~+305'},
    {category:'æ–',level:11,name:'ç‹è€…ä¹‹æ‰‹',stats:'ç²¾ç¥+53~+60 é–ƒèº²+10 é­”æ”»+300~+330'},
    {category:'æ–',level:11,name:'æ˜ŸéŒ˜æ–',stats:'æ”»æ“Š+153~+181 é˜²ç¦¦+50 é­”æ”»+228~+251'},
    // æŠ•å…·
    {category:'æŠ•å…·',level:1,name:'æœ¨è£½å¤§å‹å›åŠ›é¢',stats:'æ”»æ“Š+12~+23'},
    {category:'æŠ•å…·',level:1,name:'é’éŠ…å›åŠ›é¢',stats:'æ”»æ“Š+18~+35'},
    {category:'æŠ•å…·',level:2,name:'è¿½è·¡è€…',stats:'æ”»æ“Š+25~+46'},
    {category:'æŠ•å…·',level:2,name:'å½©å…‰å›åŠ›é¢',stats:'æ”»æ“Š+32~+58'},
    {category:'æŠ•å…·',level:3,name:'æš—æ®ºå›åŠ›é¢',stats:'æ”»æ“Š+41~+69'},
    {category:'æŠ•å…·',level:3,name:'æ®ºæ•µå›åŠ›é¢',stats:'æ”»æ“Š+49~+81'},
    {category:'æŠ•å…·',level:4,name:'ç…å­å›åŠ›é¢',stats:'æ”»æ“Š+60~+92'},
    {category:'æŠ•å…·',level:4,name:'éŠ³è§’å›åŠ›é¢',stats:'æ”»æ“Š+68~+104'},
    {category:'æŠ•å…·',level:5,name:'ç¿¼é¹¿å›åŠ›é¢',stats:'æ”»æ“Š+81~+115'},
    {category:'æŠ•å…·',level:5,name:'é˜¿ä¿®å¡”ç¾…å›åŠ›é¢',stats:'æ”»æ“Š+89~+127'},
    {category:'æŠ•å…·',level:5,name:'åŒ—æ–—ä¹‹éŒåˆ€',stats:'æ”»æ“Š+85~+135 å¿…æ®º+1~+5'},
    {category:'æŠ•å…·',level:6,name:'è›‡ç…å›åŠ›é¢',stats:'æ”»æ“Š+104~+138'},
    {category:'æŠ•å…·',level:6,name:'é¶‡å›åŠ›é¢',stats:'æ”»æ“Š+113~+150'},
    {category:'æŠ•å…·',level:7,name:'é›„ç¿¼ç‰›å›åŠ›é¢',stats:'æ”»æ“Š+130~+173'},
    {category:'æŠ•å…·',level:7,name:'é–ƒå…‰å›åŠ›é¢',stats:'æ”»æ“Š+130~+140 å¿…æ®º+15'},
    {category:'æŠ•å…·',level:7,name:'å†°é¾',stats:'æ”»æ“Š+173 ç²¾ç¥+10 å¿…æ®º+20'},
    {category:'æŠ•å…·',level:8,name:'å‡¶è±¹å›åŠ›é¢',stats:'æ”»æ“Š+147~+196'},
    {category:'æŠ•å…·',level:8,name:'èµ¤ç…å›åŠ›é¢',stats:'æ”»æ“Š+130~+160'},
    {category:'æŠ•å…·',level:8,name:'ç†Šç¿¼å›åŠ›é¢+',stats:'æ”»æ“Š+130~+155 æ•æ·+10~+20'},
    {category:'æŠ•å…·',level:9,name:'å¤©ä½¿ä¹‹ç¿¼',stats:'æ”»æ“Š+175~+219'},
    {category:'æŠ•å…·',level:9,name:'æ™®åˆ©è¾›å›åŠ›é¢',stats:'æ”»æ“Š+220~+230'},
    {category:'æŠ•å…·',level:10,name:'æ²»ç™’å›åŠ›é¢',stats:'æ”»æ“Š+216~+242'},
    {category:'æŠ•å…·',level:10,name:'å¤©ç§¤å›åŠ›é¢',stats:'æ”»æ“Š+236~+242 é˜²ç¦¦+5'},
    {category:'æŠ•å…·',level:11,name:'åŸºç›¤é£›é¢',stats:'æ”»æ“Š+201~+221 é­”åŠ›+152~+199 ç²¾ç¥+20'},
    {category:'æŠ•å…·',level:11,name:'ç¯€åˆ¶é£›é¢',stats:'æ”»æ“Š+230~+251 å‘½ä¸­+6 é–ƒèº²+10'},
    // å°åˆ€
    {category:'å°åˆ€',level:1,name:'å°åˆ€',stats:'æ”»æ“Š+9~+18 å¿…æ®º+3'},
    {category:'å°åˆ€',level:1,name:'éŠ³åˆƒå°åˆ€',stats:'æ”»æ“Š+14~+27 å¿…æ®º+3'},
    {category:'å°åˆ€',level:2,name:'åœ“ç›¤å°åˆ€',stats:'æ”»æ“Š+20~+36 å¿…æ®º+3'},
    {category:'å°åˆ€',level:2,name:'ç´°åˆƒæ“²åˆ€',stats:'æ”»æ“Š+25~+45 å¿…æ®º+3'},
    {category:'å°åˆ€',level:3,name:'æ»‘ç¿”å°åˆ€',stats:'æ”»æ“Š+32~+54 å¿…æ®º+3'},
    {category:'å°åˆ€',level:3,name:'ç´°ç›´åˆƒå°åˆ€',stats:'æ”»æ“Š+38~+63 å¿…æ®º+3'},
    {category:'å°åˆ€',level:4,name:'è€³æŸ„å°åˆ€',stats:'æ”»æ“Š+47~+72 å¿…æ®º+3'},
    {category:'å°åˆ€',level:4,name:'é¨å£«å°åˆ€',stats:'æ”»æ“Š+53~+81 å¿…æ®º+3'},
    {category:'å°åˆ€',level:5,name:'çƒé”å°åˆ€',stats:'æ”»æ“Š+63~+90 å¿…æ®º+3'},
    {category:'å°åˆ€',level:5,name:'é›™åˆƒå°åˆ€',stats:'æ”»æ“Š+69~+99 å¿…æ®º+3'},
    {category:'å°åˆ€',level:5,name:'å¿è€…é£›é¢',stats:'æ”»æ“Š+66~+110 æ•æ·+1~+6 å¿…æ®º+3'},
    {category:'å°åˆ€',level:6,name:'é—Šåˆƒå°åˆ€',stats:'æ”»æ“Š+81~+108 å¿…æ®º+3'},
    {category:'å°åˆ€',level:6,name:'è§¸è§’å°åˆ€',stats:'æ”»æ“Š+88~+117 å¿…æ®º+3'},
    {category:'å°åˆ€',level:7,name:'æ¼¢æ‹‰æå°åˆ€',stats:'æ”»æ“Š+116~+126 å¿…æ®º+3 å‘½ä¸­+15'},
    {category:'å°åˆ€',level:7,name:'å…‡æ®ºåˆ€',stats:'æ”»æ“Š+101~+135 å¿…æ®º+3'},
    {category:'å°åˆ€',level:7,name:'æ°´é¾çš„å°åˆ€',stats:'æ”»æ“Š+129 å‘½ä¸­+25'},
    {category:'å°åˆ€',level:8,name:'åˆ‡è‚‰å°åˆ€',stats:'æ”»æ“Š+50 æ•æ·+15 å¿…æ®º+18 å‘½ä¸­+15 é–ƒèº²+15'},
    {category:'å°åˆ€',level:8,name:'å¤å‚³å°åˆ€',stats:'æ”»æ“Š+115~+153 å¿…æ®º+3'},
    {category:'å°åˆ€',level:8,name:'ç–¾é€ŸçŸ­åˆ€+',stats:'æ”»æ“Š+110~+140 å¿…æ®º+1~+5'},
    {category:'å°åˆ€',level:9,name:'è¯éº—å°åˆ€',stats:'æ”»æ“Š+137~+171 å¿…æ®º+3'},
    {category:'å°åˆ€',level:9,name:'æ‰‹è£¡åŠ',stats:'æ”»æ“Š+117~+151 å¿…æ®º+6 å‘½ä¸­+3'},
    {category:'å°åˆ€',level:10,name:'å‹¾çˆªæ“²åˆ€',stats:'æ”»æ“Š+161~+189 å¿…æ®º+3'},
    {category:'å°åˆ€',level:10,name:'å¹»ä¹‹åŒ•é¦–',stats:'æ”»æ“Š+190~+210 å¿…æ®º-3'},
    {category:'å°åˆ€',level:11,name:'ç ´æ»…åˆ€',stats:'æ”»æ“Š+190~+193 å‘½ä¸­+10 é–ƒèº²+4'},
    {category:'å°åˆ€',level:11,name:'å…‡æ®˜åˆ€',stats:'æ”»æ“Š+186~+195 å¿…æ®º+11'},
    // é ­ç›”
    {category:'é ­ç›”',level:1,name:'ç¡¬çš®é ­ç›”',stats:'é˜²ç¦¦+6~+11 æŠ—é­”+5~+7'},
    {category:'é ­ç›”',level:1,name:'éŠ…è£½é ­ç›”',stats:'é˜²ç¦¦+9~+17 æŠ—é­”+3~+5'},
    {category:'é ­ç›”',level:2,name:'éµæ¿å¸ƒç›”',stats:'é˜²ç¦¦+12~+22 æŠ—é­”+10~+14'},
    {category:'é ­ç›”',level:2,name:'éŠ…éµçš®ç›”',stats:'é˜²ç¦¦+15~+28 æŠ—é­”+6~+10'},
    {category:'é ­ç›”',level:3,name:'é‡‘å±¬è­·é¡',stats:'é˜²ç¦¦+20~+33 æŠ—é­”+15~+21'},
    {category:'é ­ç›”',level:3,name:'éµè£½é ­ç›”',stats:'é˜²ç¦¦+23~+39 æŠ—é­”+9~+15'},
    {category:'é ­ç›”',level:4,name:'éœ¸è‘›é ­ç›”',stats:'é˜²ç¦¦+29~+44 æŠ—é­”+20~+28'},
    {category:'é ­ç›”',level:4,name:'è§’é£¾é ­ç›”',stats:'é˜²ç¦¦+33~+50 æŠ—é­”+12~+20'},
    {category:'é ­ç›”',level:5,name:'é–‹æ”¾å¼é ­ç›”',stats:'é˜²ç¦¦+39~+55 æŠ—é­”+25~+35'},
    {category:'é ­ç›”',level:5,name:'è‘›ç†å…‹é ­ç›”',stats:'é˜²ç¦¦+43~+61 æŠ—é­”+15~+25'},
    {category:'é ­ç›”',level:5,name:'è–é¨å£«ä¹‹ç›”',stats:'é˜²ç¦¦+42~+52 æŠ—é­”+35~+39'},
    {category:'é ­ç›”',level:6,name:'å·´æ¯”å…‹é ­ç›”',stats:'é˜²ç¦¦+50~+66 æŠ—é­”+30~+42'},
    {category:'é ­ç›”',level:6,name:'åˆ©åˆƒé ­ç›”',stats:'é˜²ç¦¦+54~+72 æŠ—é­”+18~+30'},
    {category:'é ­ç›”',level:7,name:'é¨å£«é ­ç›”',stats:'é˜²ç¦¦+60 æŠ—é­”+28~+42'},
    {category:'é ­ç›”',level:7,name:'é‹¼è£½é ­ç›”',stats:'é˜²ç¦¦+62~+83 æŠ—é­”+24~+38'},
    {category:'é ­ç›”',level:7,name:'æ°´é¾ä¹‹ç›”',stats:'é˜²ç¦¦+110'},
    {category:'é ­ç›”',level:8,name:'åšæµè“‹çˆ¾é ­ç›”',stats:'é˜²ç¦¦+65 é–ƒèº²+25 æŠ—é­”+10'},
    {category:'é ­ç›”',level:8,name:'é‰šé‡˜é ­ç›”',stats:'é˜²ç¦¦+71~+94 æŠ—é­”+32~+48'},
    {category:'é ­ç›”',level:8,name:'é‹¼è£½é ­ç›”+',stats:'é˜²ç¦¦+65~+85 é–ƒèº²+1~+5 æŠ—é­”+16~+32'},
    {category:'é ­ç›”',level:9,name:'ç¾½æ¯›é ­ç›”',stats:'é˜²ç¦¦+84~+105 æŠ—é­”+45~+63'},
    {category:'é ­ç›”',level:9,name:'é¾ç›”',stats:'é˜²ç¦¦+85 å‘½ä¸­+3 æŠ—é­”+24~+36'},
    {category:'é ­ç›”',level:10,name:'ç™½é‡‘é ­ç›”',stats:'é˜²ç¦¦+99~+116 æŠ—é­”+50~+70'},
    {category:'é ­ç›”',level:10,name:'è–é¾é ­ç›”',stats:'é˜²ç¦¦+130 æŠ—é­”+40~+60'},
    {category:'é ­ç›”',level:11,name:'æ­£ç¾©é ­ç›”',stats:'é˜²ç¦¦+95 å¿…æ®º+6 æŠ—é­”+77~+87'},
    {category:'é ­ç›”',level:11,name:'éˆåŠ›é ­ç›”',stats:'é˜²ç¦¦+105~+111 åæ“Š+8 æŠ—é­”+74~+77'},
    // å¸½å­
    {category:'å¸½å­',level:1,name:'éº»å¸ƒå¸½',stats:'é˜²ç¦¦+4~+7 å‘½ä¸­+5'},
    {category:'å¸½å­',level:1,name:'ç¡¬å¸½',stats:'é˜²ç¦¦+6~+11 å‘½ä¸­+5'},
    {category:'å¸½å­',level:2,name:'è¼•å¸½',stats:'é˜²ç¦¦+8~+14 å‘½ä¸­+5'},
    {category:'å¸½å­',level:2,name:'çš®å¸½',stats:'é˜²ç¦¦+10~+18 å‘½ä¸­+5'},
    {category:'å¸½å­',level:3,name:'ç¡¬çš®å¸½',stats:'é˜²ç¦¦+13~+21 å‘½ä¸­+5'},
    {category:'å¸½å­',level:3,name:'å¯æ„›çš„å¸½å­',stats:'é˜²ç¦¦+15~+25 å‘½ä¸­+5'},
    {category:'å¸½å­',level:4,name:'æ™‚é«¦å¸½å­',stats:'é˜²ç¦¦+18~+28 å‘½ä¸­+5'},
    {category:'å¸½å­',level:4,name:'é´¨èˆŒå¸½',stats:'é˜²ç¦¦+21~+32 å‘½ä¸­+5'},
    {category:'å¸½å­',level:5,name:'è—å¾½ç« ä¹‹å¸½',stats:'é˜²ç¦¦+25~+35 å‘½ä¸­+5'},
    {category:'å¸½å­',level:5,name:'é«˜ç´šå¸½å­',stats:'é˜²ç¦¦+27~+39 å‘½ä¸­+5'},
    {category:'å¸½å­',level:5,name:'åŠå®¢å¸½',stats:'é˜²ç¦¦+10~+14 ç”Ÿå‘½+66~+75 é–ƒèº²+3'},
    {category:'å¸½å­',level:6,name:'è£é£¾è‘—èŠ±çš„å¸½å­',stats:'é˜²ç¦¦+32~+42 å‘½ä¸­+5'},
    {category:'å¸½å­',level:6,name:'é’éŠ…å¸½å­',stats:'é˜²ç¦¦+35~+46 å‘½ä¸­+5'},
    {category:'å¸½å­',level:7,name:'æ·‘å¥³å¸½',stats:'é˜²ç¦¦+10 ç²¾ç¥+20'},
    {category:'å¸½å­',level:7,name:'å¯æ„›çš„æ‰å¸½å­',stats:'é˜²ç¦¦+40~+53 å‘½ä¸­+5'},
    {category:'å¸½å­',level:7,name:'æ°´é¾ä¹‹å¸½',stats:'é˜²ç¦¦+53 ç²¾ç¥+20 å‘½ä¸­+5'},
    {category:'å¸½å­',level:8,name:'è»å¸½',stats:'é˜²ç¦¦+42~+57 å‘½ä¸­+5'},
    {category:'å¸½å­',level:8,name:'æ™‚é«¦é¿æš‘å¸½',stats:'é˜²ç¦¦+32~+46 å‘½ä¸­+5'},
    {category:'å¸½å­',level:8,name:'å¯æ„›çš„æ‰å¸½å­+',stats:'é˜²ç¦¦+38~+45 å‘½ä¸­+5 é–ƒèº²+1~+3'},
    {category:'å¸½å­',level:8,name:'é ­ç›®å¸½å­',stats:'é˜²ç¦¦+56 å‘½ä¸­+5 é–ƒèº²+3'},
    {category:'å¸½å­',level:9,name:'ç¾½æ¯›å¸½',stats:'é˜²ç¦¦+54~+67 å‘½ä¸­+5'},
    {category:'å¸½å­',level:9,name:'é­”è¡“å¸«ä¹‹å¸½',stats:'é˜²ç¦¦+5 å‘½ä¸­+15'},
    {category:'å¸½å­',level:10,name:'é»ƒæ˜ä¹‹å¸½',stats:'é˜²ç¦¦+63~+75 å‘½ä¸­+5'},
    {category:'å¸½å­',level:10,name:'å¦–ç²¾ä¹‹å¸½',stats:'é˜²ç¦¦+60 å‘½ä¸­+5 é–ƒèº²+2'},
    {category:'å¸½å­',level:11,name:'è²æ–¯ç¥å¸½',stats:'é˜²ç¦¦+36~+47 é–ƒèº²+10'},
    {category:'å¸½å­',level:11,name:'ç¥å®˜å¸½',stats:'é˜²ç¦¦+67~+74 å‘½ä¸­+10'},
    // é§ç”²
    {category:'é§ç”²',level:1,name:'è»Ÿçš®ç”²',stats:'é˜²ç¦¦+11~+21 æŠ—é­”+6~+8'},
    {category:'é§ç”²',level:1,name:'è­·å¿ƒç”²',stats:'é˜²ç¦¦+16~+32 æŠ—é­”+4~+6'},
    {category:'é§ç”²',level:2,name:'é’éŠ…é§ç”²',stats:'é˜²ç¦¦+23~+42 æŠ—é­”+12~+16'},
    {category:'é§ç”²',level:2,name:'è¼•å‹é§ç”²',stats:'é˜²ç¦¦+29~+53 æŠ—é­”+8~+12'},
    {category:'é§ç”²',level:3,name:'è¼•å‹é–éŠç”²',stats:'é˜²ç¦¦+38~+63 æŠ—é­”+18~+24'},
    {category:'é§ç”²',level:3,name:'ç’°ç”²',stats:'é˜²ç¦¦+44~+74 æŠ—é­”+12~+18'},
    {category:'é§ç”²',level:4,name:'é‹¼éµé§ç”²',stats:'é˜²ç¦¦+55~+84 æŠ—é­”+24~+32'},
    {category:'é§ç”²',level:4,name:'é‡‘å±¬çš®ç”²',stats:'é˜²ç¦¦+62~+95 æŠ—é­”+16~+24'},
    {category:'é§ç”²',level:5,name:'é•·å‹é‡‘å±¬é§ç”²',stats:'é˜²ç¦¦+74~+105 æŠ—é­”+30~+40'},
    {category:'é§ç”²',level:5,name:'ç´¢ç‹€é§ç”²',stats:'é˜²ç¦¦+81~+116 æŠ—é­”+20~+30'},
    {category:'é§ç”²',level:5,name:'åŠé½’é§ç”²',stats:'é˜²ç¦¦+100~+110 æŠ—é­”+18~+28 åæ“Š+8'},
    {category:'é§ç”²',level:6,name:'é‡éµæ¿ç”²',stats:'é˜²ç¦¦+95~+126 æŠ—é­”+36~+48'},
    {category:'é§ç”²',level:6,name:'éµæ¿åŠèº«ç”²',stats:'é˜²ç¦¦+103~+137 æŠ—é­”+24~+36'},
    {category:'é§ç”²',level:7,name:'å¯¦æˆ°é§ç”²',stats:'é˜²ç¦¦+110~+147 æŠ—é­”+42~+56'},
    {category:'é§ç”²',level:7,name:'é»ƒé‡‘é§ç”²',stats:'é˜²ç¦¦+20 ç²¾ç¥+50 æŠ—é­”+40'},
    {category:'é§ç”²',level:7,name:'æ°´é¾é§ç”²',stats:'é˜²ç¦¦+170'},
    {category:'é§ç”²',level:8,name:'é‡é‡‘å±¬é§ç”²',stats:'é˜²ç¦¦+126~+179 æŠ—é­”+48~+64'},
    {category:'é§ç”²',level:8,name:'é‡ç¸ä¹‹é§',stats:'é˜²ç¦¦+130~+140 æŠ—é­”+16~+24'},
    {category:'é§ç”²',level:8,name:'å¯¦æˆ°é§ç”²+',stats:'é˜²ç¦¦+115~+155 æŠ—é­”+24~+40'},
    {category:'é§ç”²',level:9,name:'å¸ç‹ä¹‹é§',stats:'é˜²ç¦¦+160~+200 æŠ—é­”+27~+36'},
    {category:'é§ç”²',level:9,name:'äº¡éˆé§ç”²',stats:'é˜²ç¦¦+160 é–ƒèº²+10 æŠ—é­”+12'},
    {category:'é§ç”²',level:10,name:'æ¼†é»‘ä¹‹é§',stats:'é˜²ç¦¦+188~+221 æŠ—é­”+70~+80'},
    {category:'é§ç”²',level:10,name:'é¨å£«é§ç”²',stats:'é˜²ç¦¦+240 æŠ—é­”+50~+60'},
    {category:'é§ç”²',level:11,name:'ç´…ç¹©å¨é§',stats:'é˜²ç¦¦+214~+222 å‘½ä¸­+8 æŠ—é­”+51'},
    {category:'é§ç”²',level:11,name:'å®ˆè­·é§ç”²',stats:'é˜²ç¦¦+227 ç”Ÿå‘½+93 æŠ—é­”+99'},
    // è¡£æœ
    {category:'è¡£æœ',level:1,name:'æ—…äººä¹‹æœ',stats:'é˜²ç¦¦+7~+14 é–ƒèº²+5'},
    {category:'è¡£æœ',level:1,name:'ä¿è­·è¡£',stats:'é˜²ç¦¦+11~+21 é–ƒèº²+5'},
    {category:'è¡£æœ',level:2,name:'ç¾½æ¯›è£',stats:'é˜²ç¦¦+15~+28 é–ƒèº²+5'},
    {category:'è¡£æœ',level:2,name:'çš®è£',stats:'é˜²ç¦¦+19~+35 é–ƒèº²+5'},
    {category:'è¡£æœ',level:3,name:'ç¡¬çš®æœ',stats:'é˜²ç¦¦+21~+42 é–ƒèº²+5'},
    {category:'è¡£æœ',level:3,name:'é–éˆè£',stats:'é˜²ç¦¦+29~+49 é–ƒèº²+5'},
    {category:'è¡£æœ',level:4,name:'å¸ƒç”²',stats:'é˜²ç¦¦+36~+56 é–ƒèº²+5'},
    {category:'è¡£æœ',level:4,name:'è¥¯ç”²',stats:'é˜²ç¦¦+41~+64 é–ƒèº²+5'},
    {category:'è¡£æœ',level:5,name:'ç’°æœ',stats:'é˜²ç¦¦+49~+70 é–ƒèº²+5'},
    {category:'è¡£æœ',level:5,name:'å£«å…µè­·è¡£',stats:'é˜²ç¦¦+54~+78 é–ƒèº²+5'},
    {category:'è¡£æœ',level:5,name:'åŠŸå¤«è£',stats:'é˜²ç¦¦+38~+48 æŠ—é­”+15~+18'},
    {category:'è¡£æœ',level:6,name:'é•·ç´¢éŒè¡£',stats:'é˜²ç¦¦+63~+84 é–ƒèº²+5'},
    {category:'è¡£æœ',level:6,name:'ç´¢éŒä¸Šè¡£',stats:'é˜²ç¦¦+68~+92 é–ƒèº²+5'},
    {category:'è¡£æœ',level:7,name:'éª¨è¡£',stats:'é˜²ç¦¦+79~+105 é–ƒèº²+5'},
    {category:'è¡£æœ',level:7,name:'è¶…ç´šè¡£æœ',stats:'é˜²ç¦¦+74~+98 é–ƒèº²+5'},
    {category:'è¡£æœ',level:7,name:'æ°´é¾ä¹‹æœ',stats:'é˜²ç¦¦+30 é–ƒèº²+80'},
    {category:'è¡£æœ',level:8,name:'ç–¾é¢¨ä¹‹è¡£',stats:'é˜²ç¦¦+100~+112 å‘½ä¸­+2 é–ƒèº²+5'},
    {category:'è¡£æœ',level:8,name:'æ­¥å…µæˆ°è¡£',stats:'é˜²ç¦¦+89~+119 é–ƒèº²+5'},
    {category:'è¡£æœ',level:8,name:'ç¸éª¨ä¹‹è¡£+',stats:'é˜²ç¦¦+88~+115 æ•æ·+10~+20 é–ƒèº²+5'},
    {category:'è¡£æœ',level:9,name:'å‹‡è€…ä¹‹è¡£',stats:'é˜²ç¦¦+116~+133 é–ƒèº²+5'},
    {category:'è¡£æœ',level:9,name:'å¥³ç¥ä¹‹è¡£',stats:'é˜²ç¦¦+95 å‘½ä¸­+2 é–ƒèº²+15'},
    {category:'è¡£æœ',level:10,name:'ä¸æ­»é³¥ä¹‹æœ',stats:'é˜²ç¦¦+135~+147 é–ƒèº²+5'},
    {category:'è¡£æœ',level:10,name:'éˆé­‚ä¹‹æœ',stats:'é˜²ç¦¦+120 å‘½ä¸­+2 é–ƒèº²+5'},
    {category:'è¡£æœ',level:11,name:'æµ·æ´‹ä¹‹æœ',stats:'æ”»æ“Š+20 é˜²ç¦¦+163~+181 å‘½ä¸­+5'},
    {category:'è¡£æœ',level:11,name:'å¹»æƒ³ä¹‹æœ',stats:'é˜²ç¦¦+90~+92 å›å¾©+10 å¿…æ®º+5'},
    // é•·è¢
    {category:'é•·è¢',level:1,name:'ç¾½æ¯›è¢',stats:'é˜²ç¦¦+4~+8 é­”åŠ›+40~+50'},
    {category:'é•·è¢',level:1,name:'è¼•çš®è¢',stats:'é˜²ç¦¦+6~+12 é­”åŠ›+60~+75'},
    {category:'é•·è¢',level:2,name:'ç¶²è¢',stats:'é˜²ç¦¦+9~+16 é­”åŠ›+80~+100'},
    {category:'é•·è¢',level:2,name:'é¢¨è¢',stats:'é˜²ç¦¦+11~+20 é­”åŠ›+100~+125'},
    {category:'é•·è¢',level:3,name:'ç¡¬çš®è¢',stats:'é˜²ç¦¦+14~+24 é­”åŠ›+120~+150'},
    {category:'é•·è¢',level:3,name:'ç’°è¢',stats:'é˜²ç¦¦+17~+28 é­”åŠ›+140~+175'},
    {category:'é•·è¢',level:4,name:'çƒé´‰ä¹‹è¢',stats:'é˜²ç¦¦+21~+32 é­”åŠ›+160~+200'},
    {category:'é•·è¢',level:4,name:'æœˆäº®ä¹‹è¢',stats:'é˜²ç¦¦+23~+36 é­”åŠ›+180~+225'},
    {category:'é•·è¢',level:4,name:'ç‹çš®æŠ«é¢¨',stats:'é˜²ç¦¦+17~+22 æ•æ·+7~+12 é­”åŠ›+47~+59'},
    {category:'é•·è¢',level:5,name:'æ±æ–¹æ³•è¡£',stats:'é˜²ç¦¦+28~+40 é­”åŠ›+200~+250'},
    {category:'é•·è¢',level:5,name:'è–å ‚ä¹‹è¢',stats:'é˜²ç¦¦+31~+44 é­”åŠ›+220~+275'},
    {category:'é•·è¢',level:5,name:'æ²»ç™’ä¹‹è¢',stats:'é˜²ç¦¦+68~+75 é­”åŠ›+151~+174 å›å¾©+8'},
    {category:'é•·è¢',level:6,name:'è–è€…ä¹‹è¢',stats:'é˜²ç¦¦+36~+48 é­”åŠ›+240~+300'},
    {category:'é•·è¢',level:6,name:'æˆ°é¬¥é•·è¢',stats:'é˜²ç¦¦+39~+52 é­”åŠ›+260~+325'},
    {category:'é•·è¢',level:7,name:'å† è»ä¹‹è¢',stats:'é˜²ç¦¦+42~+56'},
    {category:'é•·è¢',level:7,name:'æ™‚ä¹‹è¢',stats:'é˜²ç¦¦+45~+60 é­”åŠ›+300~+375'},
    {category:'é•·è¢',level:7,name:'æ°´é¾æ³•è¢',stats:'é˜²ç¦¦+70 é­”åŠ›+500'},
    {category:'é•·è¢',level:8,name:'æ­»ç¥ä¹‹è¢',stats:'é˜²ç¦¦+48~+64 é­”åŠ›+320~+400'},
    {category:'é•·è¢',level:8,name:'å‹‡è€…ä¹‹è¢',stats:'é˜²ç¦¦+51~+68 é­”åŠ›+340~+425'},
    {category:'é•·è¢',level:8,name:'æ½”æ·¨ä¹‹è¢+',stats:'é˜²ç¦¦+45~+61 é­”åŠ›+300~+400 å›å¾©+1~+5'},
    {category:'é•·è¢',level:9,name:'é»‘æš—ä¹‹è¢',stats:'é˜²ç¦¦+61~+76 é­”åŠ›+380~+475'},
    {category:'é•·è¢',level:9,name:'è–è¢',stats:'é˜²ç¦¦-10 é­”åŠ›+650'},
    {category:'é•·è¢',level:10,name:'éˆé­‚ä¹‹è¢',stats:'é˜²ç¦¦+71~+84 é­”åŠ›+480~+525'},
    {category:'é•·è¢',level:10,name:'å¥‡è¹Ÿä¹‹è¢',stats:'é˜²ç¦¦+80 é­”åŠ›+400'},
    {category:'é•·è¢',level:11,name:'å…±é³´ä¹‹è¢',stats:'é˜²ç¦¦+27~+30 å›å¾©+10 é–ƒèº²+10 é­”åŠ›+514~+550'},
    {category:'é•·è¢',level:11,name:'å’Œå¹³ä¹‹è¢',stats:'é˜²ç¦¦+120 å¿…æ®º+10 é­”åŠ›+179'},
    // é´å­
    {category:'é´å­',level:1,name:'è»Ÿçš®é´',stats:'é˜²ç¦¦+5~+10 æŠ—é­”+3~+5'},
    {category:'é´å­',level:1,name:'çš®é´',stats:'é˜²ç¦¦+8~+15 æŠ—é­”+1~+3'},
    {category:'é´å­',level:2,name:'ç¡¬çš®é´',stats:'é˜²ç¦¦+10~+19 æŠ—é­”+6~+10'},
    {category:'é´å­',level:2,name:'é•·é´',stats:'é˜²ç¦¦+13~+24 æŠ—é­”+2~+6'},
    {category:'é´å­',level:3,name:'åšåº•é´',stats:'é˜²ç¦¦+17~+29 æŠ—é­”+9~+15'},
    {category:'é´å­',level:3,name:'ç·¨ç¹”çš„é´å­',stats:'é˜²ç¦¦+20~+34 æŠ—é­”+3~+9'},
    {category:'é´å­',level:4,name:'é–éŠé•·é´',stats:'é˜²ç¦¦+25~+38 æŠ—é­”+12~+20'},
    {category:'é´å­',level:4,name:'é–éŠé´',stats:'é˜²ç¦¦+28~+43 æŠ—é­”+4~+12'},
    {category:'é´å­',level:5,name:'èœ¥èªé´',stats:'é˜²ç¦¦+34~+48 æŠ—é­”+15~+25'},
    {category:'é´å­',level:5,name:'èœ¥èªé•·é´',stats:'é˜²ç¦¦+37~+53 æŠ—é­”+5~+15'},
    {category:'é´å­',level:5,name:'é˜²è­·é´',stats:'é˜²ç¦¦+16~+20 å¿…æ®º+6 æŠ—é­”+1~+10'},
    {category:'é´å­',level:6,name:'é‹¼é´',stats:'é˜²ç¦¦+43~+57 æŠ—é­”+18~+30'},
    {category:'é´å­',level:6,name:'é‹¼è£½é•·é´',stats:'é˜²ç¦¦+47~+62 æŠ—é­”+6~+18'},
    {category:'é´å­',level:7,name:'æ°´æ™¶é´',stats:'é˜²ç¦¦+54~+72 æŠ—é­”+21~+35'},
    {category:'é´å­',level:7,name:'éŠ€é´',stats:'é˜²ç¦¦+50~+67 æ•æ·+10 æŠ—é­”+12'},
    {category:'é´å­',level:7,name:'æ°´é¾ä¹‹é´',stats:'é˜²ç¦¦+100 é­”åŠ›+150 å¿…æ®º+5 å‘½ä¸­+5'},
    {category:'é´å­',level:8,name:'æµæ°´ä¹‹é´',stats:'é˜²ç¦¦+61~+81 æŠ—é­”+24~+40'},
    {category:'é´å­',level:8,name:'èŠ™è•¾é›…ä¹‹é´',stats:'é˜²ç¦¦+30 å¿…æ®º+4 åæ“Š+4 æŠ—é­”+16'},
    {category:'é´å­',level:8,name:'æ¨™æº–é•·é´+',stats:'é˜²ç¦¦+55~+75 é–ƒèº²+1~+3 æŠ—é­”+8~+24'},
    {category:'é´å­',level:9,name:'é‘½çŸ³é´',stats:'é˜²ç¦¦+78~+91 æŠ—é­”+27~+45'},
    {category:'é´å­',level:9,name:'é‘½çŸ³é•·é´',stats:'é˜²ç¦¦+80 å¿…æ®º+3 åæ“Š+3 æŠ—é­”+18'},
    {category:'é´å­',level:10,name:'ç§˜å¯†ä¹‹é´',stats:'é˜²ç¦¦+85~+100 æŠ—é­”+40~+50'},
    {category:'é´å­',level:10,name:'é¾ä¹‹é´',stats:'é˜²ç¦¦+85 æ•æ·+15 å‘½ä¸­+3 é–ƒèº²+3 æŠ—é­”+15'},
    {category:'é´å­',level:11,name:'å¹¸é‹é´',stats:'é˜²ç¦¦+79~+92 é–ƒèº²+10 æŠ—é­”+20~+25'},
    {category:'é´å­',level:11,name:'è©¦åŠ›é‹',stats:'é˜²ç¦¦+101~+116 åæ“Š+6 æŠ—é­”+55~+59'},
    // é‹å­
    {category:'é‹å­',level:1,name:'é‹å‹•é‹',stats:'é˜²ç¦¦+2~+3 æ•æ·+3~+4'},
    {category:'é‹å­',level:1,name:'é¦¬è»Šé‹',stats:'é˜²ç¦¦+3~+5 æ•æ·+5~+6'},
    {category:'é‹å­',level:2,name:'çš®é‹',stats:'é˜²ç¦¦+3~+6 æ•æ·+6~+8'},
    {category:'é‹å­',level:2,name:'å®‰å…¨é‹',stats:'é˜²ç¦¦+4~+8 æ•æ·+8~+10'},
    {category:'é‹å­',level:3,name:'å…‰ä¹‹é‹',stats:'é˜²ç¦¦+5~+9 æ•æ·+10~+12'},
    {category:'é‹å­',level:3,name:'æˆ°é‹',stats:'é˜²ç¦¦+7~+11 æ•æ·+11~+14'},
    {category:'é‹å­',level:4,name:'è–„æ¿é‹',stats:'é˜²ç¦¦+8~+12 æ•æ·+13~+16'},
    {category:'é‹å­',level:4,name:'é–éˆé‹',stats:'é˜²ç¦¦+9~+14 æ•æ·+14~+18'},
    {category:'é‹å­',level:5,name:'èœ¥èªé‹',stats:'é˜²ç¦¦+11~+15 æ•æ·+16~+20'},
    {category:'é‹å­',level:5,name:'ç¶­äº¬é‹',stats:'é˜²ç¦¦+12~+17 æ•æ·+18~+22'},
    {category:'é‹å­',level:5,name:'ç‰¹è£½èˆé‹',stats:'é˜²ç¦¦+13~+15 æ•æ·+19~+21 ç²¾ç¥+8'},
    {category:'é‹å­',level:6,name:'æˆ°é¬¥é‹',stats:'é˜²ç¦¦+14~+18 æ•æ·+19~+24'},
    {category:'é‹å­',level:6,name:'é¨å£«é‹',stats:'é˜²ç¦¦+15~+20 æ•æ·+21~+26'},
    {category:'é‹å­',level:7,name:'å¦–ç²¾é‹',stats:'é˜²ç¦¦+17~+23 æ•æ·+24~+30'},
    {category:'é‹å­',level:7,name:'ç´«æ°´æ™¶é‹',stats:'é˜²ç¦¦+44~+54'},
    {category:'é‹å­',level:7,name:'æ°´é¾ä¹‹é‹',stats:'é˜²ç¦¦+30 æ•æ·+30 é–ƒèº²+2 å‘½ä¸­+2'},
    {category:'é‹å­',level:8,name:'ç™½é‡‘é‹',stats:'é˜²ç¦¦+20~+26 æ•æ·+26~+32'},
    {category:'é‹å­',level:8,name:'ç²¾ç·»é«˜æ ¹é‹',stats:'é˜²ç¦¦+20~+26 æ•æ·-60 é­”åŠ›+90'},
    {category:'é‹å­',level:8,name:'å¦–ç²¾é‹+',stats:'é˜²ç¦¦+18~+24 æ•æ·+34~+40'},
    {category:'é‹å­',level:9,name:'ç¥ç§˜ä¹‹é‹',stats:'é˜²ç¦¦+23~+29 æ•æ·+30~+38'},
    {category:'é‹å­',level:9,name:'åŠ›é‡ä¹‹é‹',stats:'é˜²ç¦¦+23 æ•æ·+30'},
    {category:'é‹å­',level:10,name:'é»ƒé‡‘é‹',stats:'é˜²ç¦¦+27~+32 æ•æ·+36~+42'},
    {category:'é‹å­',level:10,name:'é¾ä¹‹é‹',stats:'é˜²ç¦¦+37~+42 æ•æ·+31~+37 é–ƒèº²+3'},
    {category:'é‹å­',level:11,name:'å®ˆè­·ä¹‹é‹',stats:'é˜²ç¦¦+10~+15 æ•æ·+45~+64 é–ƒèº²+15'},
    {category:'é‹å­',level:11,name:'å¤§æœ¨å±',stats:'é˜²ç¦¦+47~+60 æ•æ·+11~+17 ç²¾ç¥+5 å¿…æ®º+6'},
    // ç›¾ç‰Œ
    {category:'ç›¾ç‰Œ',level:1,name:'å°åœ“ç›¾',stats:'é˜²ç¦¦+6~+11 æŠ—é­”+10~+12'},
    {category:'ç›¾ç‰Œ',level:1,name:'å°å‹ç›¾',stats:'é˜²ç¦¦+9~+17 æŠ—é­”+8~+10'},
    {category:'ç›¾ç‰Œ',level:2,name:'æ¿ç›¾',stats:'é˜²ç¦¦+12~+22 æŠ—é­”+20~+24'},
    {category:'ç›¾ç‰Œ',level:2,name:'é³¶ç›¾',stats:'é˜²ç¦¦+15~+28 æŠ—é­”+16~+20'},
    {category:'ç›¾ç‰Œ',level:3,name:'æ¼©æ¸¦é‡ç›¾',stats:'é˜²ç¦¦+20~+33 æŠ—é­”+30~+36'},
    {category:'ç›¾ç‰Œ',level:3,name:'å“¥ç‰¹ç›¾',stats:'é˜²ç¦¦+23~+39 æŠ—é­”+24~+30'},
    {category:'ç›¾ç‰Œ',level:4,name:'å£«å…µç›¾',stats:'é˜²ç¦¦+29~+44 æŠ—é­”+40~+48'},
    {category:'ç›¾ç‰Œ',level:4,name:'é‡ç›¾',stats:'é˜²ç¦¦+33~+50 æŠ—é­”+32~+40'},
    {category:'ç›¾ç‰Œ',level:5,name:'èœ¥èªç›¾',stats:'é˜²ç¦¦+39~+55 æŠ—é­”+50~+60'},
    {category:'ç›¾ç‰Œ',level:5,name:'åå…‰ä¹‹ç›¾',stats:'é˜²ç¦¦+43~+61 æŠ—é­”+40~+50'},
    {category:'ç›¾ç‰Œ',level:5,name:'è–è€…ä¹‹ç›¾',stats:'é˜²ç¦¦+26~+29 æŠ—é­”+50~+55 é­”åŠ›+100~+120'},
    {category:'ç›¾ç‰Œ',level:6,name:'é¢¨ä¹‹ç›¾',stats:'é˜²ç¦¦+50~+67 æŠ—é­”+60~+72'},
    {category:'ç›¾ç‰Œ',level:6,name:'ç…å­ç›¾',stats:'é˜²ç¦¦+54~+72 æŠ—é­”+48~+60'},
    {category:'ç›¾ç‰Œ',level:7,name:'é˜²å®ˆä¹‹ç›¾',stats:'é˜²ç¦¦+58~+77 æŠ—é­”+70~+84'},
    {category:'ç›¾ç‰Œ',level:7,name:'é»ƒé‡‘ä¹‹ç›¾',stats:'é˜²ç¦¦+82~+103 æŠ—é­”+70'},
    {category:'ç›¾ç‰Œ',level:7,name:'æ°´é¾ä¹‹ç›¾',stats:'æ”»æ“Š+20 é˜²ç¦¦+100'},
    {category:'ç›¾ç‰Œ',level:8,name:'é¡ä¹‹ç›¾',stats:'é˜²ç¦¦+66~+88 æŠ—é­”+80~+96'},
    {category:'ç›¾ç‰Œ',level:8,name:'åŠ›é‡ä¹‹ç›¾',stats:'é˜²ç¦¦+60 é–ƒèº²+8 æŠ—é­”+32~+40'},
    {category:'ç›¾ç‰Œ',level:8,name:'é˜²ç¦¦ä¹‹ç›¾+',stats:'é˜²ç¦¦+59~+79 æ”»æ“Š+5~+20 æŠ—é­”+64~+80'},
    {category:'ç›¾ç‰Œ',level:9,name:'æ¼†é»‘ä¹‹ç›¾',stats:'é˜²ç¦¦+84~+105 æŠ—é­”+90~+108'},
    {category:'ç›¾ç‰Œ',level:9,name:'ç«é¾ä¹‹ç›¾',stats:'é˜²ç¦¦+60 å‘½ä¸­+2 é–ƒèº²+10 æŠ—é­”+36~+45'},
    {category:'ç›¾ç‰Œ',level:10,name:'é»‘æš—ä¹‹ç›¾',stats:'é˜²ç¦¦+99~+116 æŠ—é­”+115'},
    {category:'ç›¾ç‰Œ',level:10,name:'å‹‡è€…ä¹‹ç›¾',stats:'é˜²ç¦¦+90 é­”åŠ›+80 æŠ—é­”+90'},
    {category:'ç›¾ç‰Œ',level:11,name:'çªçŒ›ç›¾',stats:'é˜²ç¦¦+118 å‘½ä¸­+8 æŠ—é­”+100'},
    {category:'ç›¾ç‰Œ',level:11,name:'é‡å‹é˜²ç¦¦ç›¾',stats:'é˜²ç¦¦+98 å¿…æ®º+6 æŠ—é­”+141'},
];

// è£å‚™ç¨®é¡åˆ—è¡¨
const EQUIPMENT_CATEGORIES = ['åŠ','æ–§','æ§','å¼“','æ–','æŠ•å…·','å°åˆ€','é ­ç›”','å¸½å­','é§ç”²','è¡£æœ','é•·è¢','é´å­','é‹å­','ç›¾ç‰Œ'];
const API_MARKET_BASE = 'https://member.starcg.net/market.php';
const API_HISTORY_BASE = 'https://member.starcg.net/marketrecord.php';
const MAX_PAGES = 20;

let allMarketItems = [];
let allHistoryLogs = [];
let quickTags = JSON.parse(localStorage.getItem('starcg_quickTags')) || ['ä¸€ç®±é¢åŒ…', 'ä¸€ç®±æ³•åœ‹é¢åŒ…', 'ä¸€ç®±å£½å–œé‹'];
let currentSort = { field: 'price', order: 'asc' };
let currentTab = 'market';
const chartInstances = {};

/* ========================================
   åˆå§‹åŒ–
======================================== */
document.addEventListener('DOMContentLoaded', () => {
    renderQuickTags();
    initEventListeners();
    initEquipmentPanel();
});

function initEventListeners() {
    // æœå°‹æŒ‰éˆ•
    document.getElementById('searchBtn').addEventListener('click', searchMarket);
    document.getElementById('historyBtn').addEventListener('click', searchHistory);
    
    // Enter éµæœå°‹
    document.getElementById('searchInput').addEventListener('keypress', e => {
        if (e.key === 'Enter') searchMarket();
    });
    
    // ç¯©é¸å™¨è®Šæ›´
    ['currencyFilter', 'serverFilter', 'durabilityFilter'].forEach(id => {
        document.getElementById(id).addEventListener('change', applyFilters);
    });
    
    // åŒ¯ç‡è®Šæ›´æ™‚é‡æ–°æ¸²æŸ“
    document.getElementById('exchangeRate').addEventListener('input', applyFilters);
    
    // Tab åˆ‡æ›
    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => switchTab(tab.dataset.tab));
    });
    
    // è¡¨é ­æ’åº
    document.querySelectorAll('#marketTable th[data-sort]').forEach(th => {
        th.addEventListener('click', () => sortTable(th.dataset.sort));
    });
}

/* ========================================
   å¿«é€Ÿæ¨™ç±¤
======================================== */
function renderQuickTags() {
    const container = document.getElementById('quickTags');
    container.innerHTML = quickTags.map((tag, i) => `
        <div class="quick-tag" onclick="quickSearch('${tag}')">
            ${tag}
            <span class="remove" onclick="event.stopPropagation(); removeTag(${i})">âœ•</span>
        </div>
    `).join('');
}

function quickSearch(tag) {
    // å¦‚æœæ¨™ç±¤åŒ…å« " [Lv." å‰‡åªä½¿ç”¨åç¨±éƒ¨åˆ†æœå°‹
    const searchTerm = tag.includes(' [Lv.') ? tag.split(' [Lv.')[0] : tag;
    document.getElementById('searchInput').value = searchTerm;
    searchMarket();
}

function removeTag(index) {
    quickTags.splice(index, 1);
    localStorage.setItem('starcg_quickTags', JSON.stringify(quickTags));
    renderQuickTags();
}

function addTag(tag) {
    if (tag && !quickTags.includes(tag)) {
        quickTags.push(tag);
        localStorage.setItem('starcg_quickTags', JSON.stringify(quickTags));
        renderQuickTags();
    }
}

/* ========================================
   è£å‚™é¢æ¿åŠŸèƒ½
======================================== */
function initEquipmentPanel() {
    // åˆå§‹åŒ–ç¨®é¡ä¸‹æ‹‰é¸å–®
    const categorySelect = document.getElementById('equipmentCategoryFilter');
    EQUIPMENT_CATEGORIES.forEach(cat => {
        const option = document.createElement('option');
        option.value = cat;
        option.textContent = cat;
        categorySelect.appendChild(option);
    });

    // æ¸²æŸ“åˆå§‹åˆ—è¡¨
    renderEquipmentList(EQUIPMENT_DATA);
}

function toggleEquipmentPanel() {
    const panel = document.getElementById('equipmentPanel');
    panel.classList.toggle('open');
}

function filterEquipments() {
    const category = document.getElementById('equipmentCategoryFilter').value;
    const keyword = document.getElementById('equipmentSearchInput').value.trim().toLowerCase();

    let filtered = EQUIPMENT_DATA;

    // ç¨®é¡ç¯©é¸
    if (category !== 'all') {
        filtered = filtered.filter(eq => eq.category === category);
    }

    // åç¨±æœå°‹
    if (keyword) {
        filtered = filtered.filter(eq => eq.name.toLowerCase().includes(keyword));
    }

    renderEquipmentList(filtered);
}

function renderEquipmentList(equipments) {
    const container = document.getElementById('equipmentList');

    if (equipments.length === 0) {
        container.innerHTML = '<div class="equipment-empty">æ‰¾ä¸åˆ°ç¬¦åˆçš„è£å‚™</div>';
        return;
    }

    container.innerHTML = equipments.map(eq => `
        <div class="equipment-item">
            <div class="equipment-info">
                <div class="equipment-row">
                    <div class="equipment-main">
                        <span class="equipment-name">${escapeHtml(eq.name)}</span>
                        <span class="equipment-level">[Lv.${eq.level}]</span>
                    </div>
                    <span class="equipment-stats">${escapeHtml(eq.stats)}</span>
                </div>
            </div>
            <div class="equipment-actions">
                <button class="btn-search" onclick="searchEquipment('${escapeHtml(eq.name)}')">æœå°‹</button>
                <button class="btn-add" onclick="addEquipmentToQuickTag('${escapeHtml(eq.name)}', ${eq.level})">+</button>
            </div>
        </div>
    `).join('');
}

function searchEquipment(name) {
    document.getElementById('searchInput').value = name;
    searchMarket();
    // åœ¨æ‰‹æ©Ÿä¸Šè‡ªå‹•æ”¶åˆé¢æ¿
    if (window.innerWidth <= 768) {
        document.getElementById('equipmentPanel').classList.remove('open');
    }
}

function addEquipmentToQuickTag(name, level) {
    const tagWithLevel = `${name} [Lv.${level}]`;
    if (!quickTags.includes(tagWithLevel)) {
        quickTags.push(tagWithLevel);
        localStorage.setItem('starcg_quickTags', JSON.stringify(quickTags));
        renderQuickTags();
        // é¡¯ç¤ºæç¤º
        alert(`å·²åŠ å…¥å¿«é€Ÿæœå°‹ï¼š${tagWithLevel}`);
    } else {
        alert(`${tagWithLevel} å·²å­˜åœ¨æ–¼å¿«é€Ÿæœå°‹ä¸­`);
    }
}

/* ========================================
   å¸‚å ´æœå°‹
======================================== */
async function searchMarket() {
    const keyword = document.getElementById('searchInput').value.trim();
    if (!keyword) return alert('è«‹è¼¸å…¥æœå°‹é—œéµå­—');
    
    showLoading(true);
    hideAll();
    
    // æ¸…ç©ºèˆŠçš„æ­·å²è³‡æ–™å’Œåœ–è¡¨ï¼Œè®“åˆ‡æ› tab æ™‚é‡æ–°æœå°‹
    allHistoryLogs = [];
    // éŠ·æ¯€æ‰€æœ‰åœ–è¡¨å¯¦ä¾‹
    Object.values(chartInstances).forEach(chart => chart.destroy());
    Object.keys(chartInstances).forEach(key => delete chartInstances[key]);
    
    try {
        allMarketItems = await fetchMarketData(keyword);
        
        if (allMarketItems.length > 0) {
            addTag(keyword);
            document.getElementById('tabsContainer').style.display = 'flex';
            switchTab('market');
            applyFilters();
        } else {
            showEmpty('æ‰¾ä¸åˆ°ç¬¦åˆçš„ç‰©å“');
        }
    } catch (err) {
        console.error(err);
        alert('æœå°‹å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–æª¢æŸ¥ç¶²è·¯é€£ç·š');
        showEmpty('æœå°‹å¤±æ•—');
    } finally {
        showLoading(false);
    }
}

async function fetchMarketData(keyword) {
    const items = [];
    let page = 1;
    let hasMore = true;
    
    while (hasMore && page <= MAX_PAGES) {
        const targetUrl = `${API_MARKET_BASE}?ajax=1&type=all&server=all&exact=0&page=${page}&search=${encodeURIComponent(keyword)}`;
        const url = CORS_PROXY + encodeURIComponent(targetUrl);
        const resp = await fetch(url);
        const text = await resp.text();
        
        // æª¢æŸ¥æ˜¯å¦ç‚º HTML éŒ¯èª¤é ï¼ˆ520 ç­‰ï¼‰
        if (text.startsWith('<!') || text.startsWith('<html') || text.includes('error code:')) {
            throw new Error('ä¼ºæœå™¨æš«æ™‚ç„¡æ³•é€£ç·šï¼Œè«‹ç¨å¾Œå†è©¦');
        }
        
        if (!resp.ok) {
            throw new Error(`HTTP ${resp.status}: ${text.substring(0, 100)}`);
        }
        
        const data = JSON.parse(text);
        
        if (data.totalFiltered === 0) break;
        if (data.totalFiltered > 300) {
            alert('çµæœå¤ªå¤šï¼Œè«‹è¼¸å…¥æ›´ç²¾ç¢ºçš„é—œéµå­—');
            return [];
        }
        
        // è™•ç†æ”¤ä½è³‡æ–™
        const itemsMap = data.itemsByCd || {};
        const petsMap = data.petsByCd || {};
        
        (data.stalls || []).forEach(stall => {
            const cdkey = stall.cdkey;
            
            // é“å…·
            (itemsMap[cdkey] || []).forEach(item => {
                if (item.ITEM_TRUENAME.includes(keyword)) {
                    // ğŸ”§ DEBUG: é¡¯ç¤ºé“å…·åŸå§‹è³‡æ–™
                    console.log('ã€é“å…·åŸå§‹è³‡æ–™ã€‘', item.ITEM_TRUENAME, item);
                    
                    // è™•ç†æ”¹é€ åœ–ç­‰ç´šå€åˆ†ï¼ˆå˜—è©¦å¤šç¨®å¯èƒ½çš„æ¬„ä½åï¼‰
                    let displayName = item.ITEM_TRUENAME;
                    let gradeTag = '';
                    let seedTag = '';
                    const itemLevel = item.ITEM_LEVEL || item.level || item.Level || item.ITEM_LV || item.lv || 0;
                    if (item.ITEM_TRUENAME.includes('æ”¹é€ åœ–') && itemLevel > 0) {
                        if (itemLevel === 5) gradeTag = '<span class="grade-normal">[æ™®é€š]</span>';
                        else if (itemLevel === 6) gradeTag = '<span class="grade-silver">[éŠ€]</span>';
                        else if (itemLevel === 7) gradeTag = '<span class="grade-gold">[é‡‘]</span>';
                        else gradeTag = `<span class="grade-normal">[Lv${itemLevel}]</span>`;
                    }
                    
                    // è™•ç†é‡ä¾†çš„ç¨®å­ BP é…é»é¡¯ç¤º
                    if (item.ITEM_TRUENAME.includes('é‡ä¾†çš„ç¨®å­') && item.ITEM_ARGUMENT) {
                        const bpNames = ['é«”', 'åŠ›', 'å¼·', 'é€Ÿ', 'é­”'];
                        const bpValues = item.ITEM_ARGUMENT.split('|').map(Number);
                        let bpParts = [];
                        bpValues.forEach((val, idx) => {
                            if (val > 0) bpParts.push(`<span class="bp-plus">+${val}${bpNames[idx]}</span>`);
                            else if (val < 0) bpParts.push(`<span class="bp-minus">${val}${bpNames[idx]}</span>`);
                        });
                        if (bpParts.length > 0) seedTag = bpParts.join(' ');
                    }
                    
                    items.push({
                        item: displayName,
                        gradeTag: gradeTag,
                        seedTag: seedTag,
                        itemLevel: itemLevel,
                        price: item.price,
                        pricetype: item.pricetype,
                        durability: `${item.ITEM_DURABILITY}/${item.ITEM_MAXDURABILITY}`,
                        durCurrent: item.ITEM_DURABILITY,
                        durMax: item.ITEM_MAXDURABILITY,
                        attack: Math.max(item.ITEM_ADM || 0, item.ITEM_MODIFYATTACK || 0),
                        defence: item.ITEM_MODIFYDEFENCE || 0,
                        agility: item.ITEM_MODIFYAGILITY || 0,
                        location: stall.coords,
                        server: stall.server,
                        shopName: stall.name,
                        count: item.ITEM_REMAIN,
                        isPet: false
                    });
                }
            });
            
            // å¯µç‰©
            (petsMap[cdkey] || []).forEach(pet => {
                if (pet.Name.includes(keyword)) {
                    // å¯µç‰©æ¨™ç±¤ï¼šç­‰ç´šã€æ”¹é€ ã€æŠ€èƒ½æ¬„æ•¸
                    const petLv = pet.Lv || 1;
                    const trans = pet.Trans || 0;
                    const slot = pet.Slot || 6;
                    
                    let petTags = `<span class="pet-lv">Lv${petLv}</span>`;
                    petTags += `<span class="pet-trans">${trans}æ”¹</span>`;
                    petTags += `<span class="pet-slot">${slot}æŠ€</span>`;
                    
                    items.push({
                        item: pet.Name,
                        transTag: petTags,
                        gradeTag: '',
                        price: pet.price,
                        pricetype: pet.pricetype,
                        durability: '-',
                        durCurrent: 0,
                        durMax: 0,
                        attack: '-',
                        defence: '-',
                        agility: '-',
                        location: stall.coords,
                        server: stall.server,
                        shopName: stall.name,
                        count: 1,
                        isPet: true
                    });
                }
            });
        });
        
        if (page * (data.perPage || 20) >= data.totalFiltered) hasMore = false;
        page++;
    }
    
    return items;
}

/* ========================================
   æ­·å²æˆäº¤æœå°‹
======================================== */
async function searchHistory() {
    const keyword = document.getElementById('searchInput').value.trim();
    if (!keyword) return alert('è«‹è¼¸å…¥æœå°‹é—œéµå­—');
    
    showLoading(true);
    hideAll();
    
    try {
        allHistoryLogs = await fetchHistoryData(keyword);
        
        if (allHistoryLogs.length > 0) {
            addTag(keyword);
            document.getElementById('tabsContainer').style.display = 'flex';
            switchTab('history');
            renderHistoryData();
        } else {
            showEmpty('æ‰¾ä¸åˆ°æ­·å²æˆäº¤è¨˜éŒ„');
        }
    } catch (err) {
        console.error(err);
        alert('æœå°‹å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–æª¢æŸ¥ç¶²è·¯é€£ç·š');
        showEmpty('æœå°‹å¤±æ•—');
    } finally {
        showLoading(false);
    }
}

async function fetchHistoryData(keyword) {
    const logs = [];
    const TIME_RANGE = 72 * 60 * 60 * 1000; // 72å°æ™‚
    const now = Date.now();
    let page = 1;
    let keepFetching = true;
    
    while (keepFetching && page <= 100) {
        const targetUrl = `${API_HISTORY_BASE}?ajax=1&type=all&page=${page}&search=${encodeURIComponent(keyword)}`;
        const url = CORS_PROXY + encodeURIComponent(targetUrl);
        const resp = await fetch(url);
        const text = await resp.text();
        
        // æª¢æŸ¥æ˜¯å¦ç‚º HTML éŒ¯èª¤é ï¼ˆ520 ç­‰ï¼‰
        if (text.startsWith('<!') || text.startsWith('<html') || text.includes('error code:')) {
            throw new Error('ä¼ºæœå™¨æš«æ™‚ç„¡æ³•é€£ç·šï¼Œè«‹ç¨å¾Œå†è©¦');
        }
        
        if (!resp.ok) {
            throw new Error(`HTTP ${resp.status}: ${text.substring(0, 100)}`);
        }
        
        const data = JSON.parse(text);
        
        if (!data.logs || data.logs.length === 0) break;
        
        for (const log of data.logs) {
            const logTime = new Date(log.time_text).getTime();
            if (now - logTime > TIME_RANGE) {
                keepFetching = false;
                break;
            }
            
            // è§£æç‰©å“åç¨±
            const parts = log.buff.split('ï¼š');
            const itemName = parts.length > 1 ? parts[1] : parts[0];
            
            // é‚„åŸå”®åƒ¹ï¼ˆæ‰£é™¤ 10% æ‰‹çºŒè²»ï¼‰
            const originalPrice = Math.ceil(log.price / (log.pricetype === 1 ? 0.94 : 0.9));
            
            logs.push({
                item: itemName,
                price: originalPrice,
                pricetype: log.pricetype,
                time: log.time_text
            });
        }
        
        page++;
    }
    
    return logs;
}

/* ========================================
   ç¯©é¸èˆ‡æ’åº
======================================== */
function applyFilters() {
    const currency = document.getElementById('currencyFilter').value;
    const server = document.getElementById('serverFilter').value;
    const durability = document.getElementById('durabilityFilter').value;
    
    let filtered = [...allMarketItems];
    
    // å¹£ç¨®ç¯©é¸
    if (currency !== 'all') {
        filtered = filtered.filter(i => i.pricetype.toString() === currency);
    }
    
    // åˆ†æµç¯©é¸
    if (server !== 'all') {
        filtered = filtered.filter(i => i.server.toString() === server);
    }
    
    // è€ä¹…ç¯©é¸
    if (durability === 'full') {
        filtered = filtered.filter(i => i.isPet || i.durCurrent === i.durMax);
    }
    
    // æ’åº
    filtered = sortItems(filtered);
    
    // æ›´æ–°çµ±è¨ˆ
    updateStats(filtered);
    
    // æ¸²æŸ“è¡¨æ ¼
    renderMarketTable(filtered);
}

function sortItems(items) {
    const { field, order } = currentSort;
    
    return [...items].sort((a, b) => {
        let valA = a[field];
        let valB = b[field];
        
        // è€ä¹…ç‰¹æ®Šè™•ç†
        if (field === 'durability') {
            valA = a.durCurrent;
            valB = b.durCurrent;
        }
        
        if (typeof valA === 'string') {
            return order === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA);
        }
        return order === 'asc' ? valA - valB : valB - valA;
    });
}

function sortTable(field) {
    if (currentSort.field === field) {
        currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
    } else {
        currentSort = { field, order: 'asc' };
    }
    
    // æ›´æ–°æ’åºåœ–ç¤º
    document.querySelectorAll('#marketTable th .sort-icon').forEach(icon => {
        icon.classList.remove('active');
        icon.textContent = 'â–²';
    });
    
    const th = document.querySelector(`#marketTable th[data-sort="${field}"]`);
    if (th) {
        const icon = th.querySelector('.sort-icon') || document.createElement('span');
        icon.className = 'sort-icon active';
        icon.textContent = currentSort.order === 'asc' ? 'â–²' : 'â–¼';
        if (!th.querySelector('.sort-icon')) th.appendChild(icon);
    }
    
    applyFilters();
}

/* ========================================
   æ¸²æŸ“
======================================== */
function renderMarketTable(items) {
    const tbody = document.getElementById('marketBody');
    
    if (items.length === 0) {
        tbody.innerHTML = '<tr><td colspan="9" style="text-align:center;padding:40px;color:var(--text-secondary);">ç„¡ç¬¦åˆæ¢ä»¶çš„ç‰©å“</td></tr>';
        document.getElementById('marketSection').style.display = 'block';
        return;
    }
    
    // åˆä½µç›¸åŒç‰©å“ï¼ˆåŒæ”¤ä½ã€åŒç‰©å“ã€åŒåƒ¹æ ¼ã€åŒæ•¸å€¼æ‰åˆä½µï¼‰
    const merged = {};
    items.forEach(item => {
        // å¯µç‰©ä¸åˆä½µï¼ˆæ¯éš»éƒ½æ˜¯ç¨ç«‹å€‹é«”ï¼‰
        if (item.isPet) {
            const uniqueKey = `pet-${Date.now()}-${Math.random()}`;
            merged[uniqueKey] = { ...item };
        } else {
            // ä¸€èˆ¬ç‰©å“ï¼šåŒæ”¤ä½+åŒç‰©å“+åŒåƒ¹æ ¼+åŒæ•¸å€¼+åŒBPé…é»æ‰åˆä½µ
            const key = `${item.location}-${item.item}-${item.price}-${item.server}-${item.durability}-${item.attack}-${item.defence}-${item.agility}-${item.seedTag || ''}`;
            if (!merged[key]) {
                merged[key] = { ...item };
            } else {
                merged[key].count += item.count;
            }
        }
    });
    
    const rate = parseInt(document.getElementById('exchangeRate').value) || 300;
    
    tbody.innerHTML = Object.values(merged).map(item => {
        // è¨ˆç®—æ›ç®—åƒ¹æ ¼
        let converted = '';
        if (item.pricetype === 0) {
            // é­”å¹£æ›ç®—æˆé­”æ™¶
            const crystalVal = Math.round(item.price / rate);
            converted = `<span class="converted">(~${crystalVal.toLocaleString()}ğŸ’)</span>`;
        } else {
            // é­”æ™¶æ›ç®—æˆé­”å¹£
            const coinVal = Math.round(item.price * rate);
            converted = `<span class="converted">(~${coinVal.toLocaleString()}ğŸ’°)</span>`;
        }
        
        return `
        <tr>
            <td><strong>${escapeHtml(item.item)}</strong> ${item.gradeTag || ''}${item.seedTag || ''}${item.transTag || ''}</td>
            <td>
                <span class="price ${item.pricetype === 0 ? 'coin' : 'crystal'}">
                    ${item.pricetype === 0 ? 'ğŸ’°' : 'ğŸ’'} ${item.price.toLocaleString()}
                </span>
                ${converted}
            </td>
            <td>
                <span class="server-badge s${item.server}">S${item.server}</span>
                ${escapeHtml(item.location)}
            </td>
            <td>${escapeHtml(item.shopName)}</td>
            <td>${item.durability}</td>
            <td>${item.attack || '-'}</td>
            <td>${item.defence || '-'}</td>
            <td>${item.agility || '-'}</td>
            <td>${item.count}</td>
        </tr>`;
    }).join('');
    
    document.getElementById('marketSection').style.display = 'block';
}

function renderHistoryData() {
    // æŒ‰ç‰©å“åˆ†çµ„çµ±è¨ˆ
    const grouped = {};
    
    allHistoryLogs.forEach(log => {
        if (!grouped[log.item]) {
            grouped[log.item] = { coins: [], crystals: [], total: 0 };
        }
        if (log.pricetype === 0) {
            grouped[log.item].coins.push(log.price);
        } else {
            grouped[log.item].crystals.push(log.price);
        }
        grouped[log.item].total++;
    });
    
    // è¨ˆç®—çµ±è¨ˆ
    const stats = Object.entries(grouped).map(([item, data]) => ({
        item,
        minCoin: data.coins.length ? Math.min(...data.coins) : 0,
        maxCoin: data.coins.length ? Math.max(...data.coins) : 0,
        avgCoin: data.coins.length ? calcTrimmedAvg(data.coins) : 0,
        minCrystal: data.crystals.length ? Math.min(...data.crystals) : 0,
        maxCrystal: data.crystals.length ? Math.max(...data.crystals) : 0,
        avgCrystal: data.crystals.length ? calcTrimmedAvg(data.crystals) : 0,
        total: data.total
    }));
    
    // æ¸²æŸ“è¡¨æ ¼ï¼ˆæ¯å€‹ç‰©ä»¶å¾Œé¢åŠ ä¸Šåœ–è¡¨è¡Œï¼‰
    const tbody = document.getElementById('historyBody');
    tbody.innerHTML = stats.map((row, index) => `
        <tr>
            <td><strong>${escapeHtml(row.item)}</strong></td>
            <td style="color:var(--accent-green)">${row.minCoin ? row.minCoin.toLocaleString() : '-'}</td>
            <td style="color:var(--accent-gold)">${row.avgCoin ? row.avgCoin.toLocaleString() : '-'}</td>
            <td style="color:var(--accent-red)">${row.maxCoin ? row.maxCoin.toLocaleString() : '-'}</td>
            <td style="color:var(--accent-green)">${row.minCrystal ? row.minCrystal.toLocaleString() : '-'}</td>
            <td style="color:var(--accent-gold)">${row.avgCrystal ? row.avgCrystal.toLocaleString() : '-'}</td>
            <td style="color:var(--accent-red)">${row.maxCrystal ? row.maxCrystal.toLocaleString() : '-'}</td>
            <td>${row.total}</td>
            <td><button class="secondary" style="padding:6px 12px;font-size:0.8rem;" onclick="toggleChart(${index}, '${escapeHtml(row.item)}')">ğŸ“ˆ</button></td>
        </tr>
        <tr id="chartRow${index}" class="chart-row" style="display:none;">
            <td colspan="9" style="padding:0; background:var(--bg-dark);">
                <div class="inline-chart-container">
                    <div class="chart-title">ğŸ“ˆ ${escapeHtml(row.item)} åƒ¹æ ¼èµ°å‹¢</div>
                    <div class="inline-chart-wrapper">
                        <canvas id="chart${index}"></canvas>
                    </div>
                </div>
            </td>
        </tr>
    `).join('');
    
    document.getElementById('historySection').style.display = 'block';
}

function toggleChart(index, itemName) {
    const chartRow = document.getElementById(`chartRow${index}`);
    const isVisible = chartRow.style.display !== 'none';
    
    if (isVisible) {
        chartRow.style.display = 'none';
        return;
    }
    
    chartRow.style.display = '';
    
    // å¦‚æœå·²ç¶“ç•«éå°±ä¸é‡ç•«
    if (chartInstances[index]) return;
    
    // ç¯©é¸è©²ç‰©å“çš„è³‡æ–™ä¸¦ç°¡åŒ–
    const itemLogs = allHistoryLogs.filter(l => l.item === itemName);
    const coinData = simplifyData(itemLogs.filter(l => l.pricetype === 0).sort((a, b) => new Date(a.time) - new Date(b.time)));
    const crystalData = simplifyData(itemLogs.filter(l => l.pricetype === 1).sort((a, b) => new Date(a.time) - new Date(b.time)));
    
    const ctx = document.getElementById(`chart${index}`).getContext('2d');
    
    const datasets = [];
    if (coinData.length > 0) {
        datasets.push({
            label: 'é­”å¹£ ğŸ’°',
            data: coinData.map(d => ({ x: d.time, y: d.price })),
            borderColor: '#d4a024',
            backgroundColor: 'rgba(212, 160, 36, 0.15)',
            tension: 0.4,
            pointRadius: 3,
            borderWidth: 2,
            fill: true
        });
    }
    if (crystalData.length > 0) {
        datasets.push({
            label: 'é­”æ™¶ ğŸ’',
            data: crystalData.map(d => ({ x: d.time, y: d.price })),
            borderColor: '#9068b0',
            backgroundColor: 'rgba(144, 104, 176, 0.15)',
            tension: 0.4,
            pointRadius: 3,
            borderWidth: 2,
            fill: true
        });
    }
    
    chartInstances[index] = new Chart(ctx, {
        type: 'line',
        data: { datasets },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: { intersect: false, mode: 'index' },
            plugins: {
                legend: { display: true, labels: { color: '#4a3f35' } },
                tooltip: {
                    backgroundColor: '#fffbf5',
                    borderColor: '#e0d5c5',
                    borderWidth: 1,
                    titleColor: '#4a3f35',
                    bodyColor: '#8b7355'
                }
            },
            scales: {
                x: {
                    type: 'category',
                    ticks: { 
                        color: '#8b7355',
                        maxTicksLimit: 8,
                        maxRotation: 45,
                        minRotation: 0
                    },
                    grid: { color: '#e0d5c5' }
                },
                y: {
                    ticks: { color: '#8b7355' },
                    grid: { color: '#e0d5c5' }
                }
            }
        }
    });
}

// ç°¡åŒ–æ•¸æ“šï¼šåˆä½µç›¸åŒåƒ¹æ ¼çš„é€£çºŒæ•¸æ“šé»
function simplifyData(data) {
    if (data.length <= 20) return data;
    
    const simplified = [];
    let lastPrice = null;
    let lastTime = null;
    
    data.forEach((d, i) => {
        // ä¿ç•™ç¬¬ä¸€ç­†ã€æœ€å¾Œä¸€ç­†ã€åƒ¹æ ¼è®ŠåŒ–çš„é»
        if (i === 0 || i === data.length - 1 || d.price !== lastPrice) {
            // å¦‚æœè·³éäº†å¾ˆå¤šç›¸åŒåƒ¹æ ¼çš„é»ï¼ŒåŠ ä¸€å€‹ä¸­é–“é»æ¨™è¨˜
            if (lastPrice !== null && d.price === lastPrice && simplified.length > 0) {
                // å·²ç¶“æœ‰ç›¸åŒåƒ¹æ ¼çš„èµ·é»äº†ï¼Œè·³é
            } else {
                simplified.push(d);
            }
            lastPrice = d.price;
            lastTime = d.time;
        }
    });
    
    return simplified;
}


function updateStats(items) {
    const currency = document.getElementById('currencyFilter').value;
    const rate = parseInt(document.getElementById('exchangeRate').value) || 275;
    
    if (currency === 'all') {
        // åˆ†åˆ¥è¨ˆç®—å…©ç¨®å¹£ç¨®çš„æ•¸é‡
        const coinCount = items.filter(i => i.pricetype === 0).reduce((sum, i) => sum + i.count, 0);
        const crystalCount = items.filter(i => i.pricetype === 1).reduce((sum, i) => sum + i.count, 0);
        
        // åœ¨å”®æ•¸é‡ï¼šä¸€è¡Œé­”å¹£ã€ä¸€è¡Œé­”æ™¶
        const countLines = [];
        if (coinCount > 0) countLines.push(`ğŸ’° ${coinCount.toLocaleString()}`);
        if (crystalCount > 0) countLines.push(`ğŸ’ ${crystalCount.toLocaleString()}`);
        document.getElementById('statCount').innerHTML = countLines.length > 0 ? countLines.join('<br>') : '-';
    } else {
        // å–®ä¸€å¹£ç¨®æ¨¡å¼
        const totalCount = items.reduce((sum, i) => sum + i.count, 0);
        document.getElementById('statCount').textContent = totalCount.toLocaleString();
    }
    
    if (currency === 'all') {
        // åˆ†åˆ¥è¨ˆç®—å…©ç¨®å¹£ç¨®çš„åƒ¹æ ¼
        const coinPrices = items.filter(i => i.pricetype === 0).map(i => i.price);
        const crystalPrices = items.filter(i => i.pricetype === 1).map(i => i.price);
        
        // è¨ˆç®—æ˜Ÿå¹£çµ±è¨ˆ
        const coinMin = coinPrices.length ? Math.min(...coinPrices) : 0;
        const coinMax = coinPrices.length ? Math.max(...coinPrices) : 0;
        const coinAvg = coinPrices.length ? calcTrimmedAvg(coinPrices) : 0;
        
        // è¨ˆç®—é­”æ™¶çµ±è¨ˆ
        const crystalMin = crystalPrices.length ? Math.min(...crystalPrices) : 0;
        const crystalMax = crystalPrices.length ? Math.max(...crystalPrices) : 0;
        const crystalAvg = crystalPrices.length ? calcTrimmedAvg(crystalPrices) : 0;
        
        // æ ¼å¼åŒ–é¡¯ç¤ºï¼šä¸»è¦åƒ¹æ ¼ (~æ›ç®—åƒ¹æ ¼)
        const formatPrice = (mainPrice, convertedPrice, convertedIcon) => {
            if (mainPrice === 0) return '-';
            const converted = convertedPrice > 0 ? ` (~${convertedPrice.toLocaleString()}${convertedIcon})` : '';
            return `${mainPrice.toLocaleString()}${converted}`;
        };
        
        // æœ€ä½åƒ¹ï¼šæ˜Ÿå¹£æœ€ä½ (~é­”æ™¶æ›ç®—) / é­”æ™¶æœ€ä½ (~æ˜Ÿå¹£æ›ç®—)
        const minCoinText = coinMin > 0 ? `ğŸ’° ${formatPrice(coinMin, Math.round(coinMin / rate), 'ğŸ’')}` : '';
        const minCrystalText = crystalMin > 0 ? `ğŸ’ ${formatPrice(crystalMin, Math.round(crystalMin * rate), 'ğŸ’°')}` : '';
        document.getElementById('statMinPrice').innerHTML = [minCoinText, minCrystalText].filter(Boolean).join('<br>') || '-';
        
        // ä¸­ä½åƒ¹ï¼šæ˜Ÿå¹£ä¸­ä½ (~é­”æ™¶æ›ç®—) / é­”æ™¶ä¸­ä½ (~æ˜Ÿå¹£æ›ç®—)
        const avgCoinText = coinAvg > 0 ? `ğŸ’° ${formatPrice(coinAvg, Math.round(coinAvg / rate), 'ğŸ’')}` : '';
        const avgCrystalText = crystalAvg > 0 ? `ğŸ’ ${formatPrice(crystalAvg, Math.round(crystalAvg * rate), 'ğŸ’°')}` : '';
        document.getElementById('statAvgPrice').innerHTML = [avgCoinText, avgCrystalText].filter(Boolean).join('<br>') || '-';
        
        // æœ€é«˜åƒ¹ï¼šæ˜Ÿå¹£æœ€é«˜ (~é­”æ™¶æ›ç®—) / é­”æ™¶æœ€é«˜ (~æ˜Ÿå¹£æ›ç®—)
        const maxCoinText = coinMax > 0 ? `ğŸ’° ${formatPrice(coinMax, Math.round(coinMax / rate), 'ğŸ’')}` : '';
        const maxCrystalText = crystalMax > 0 ? `ğŸ’ ${formatPrice(crystalMax, Math.round(crystalMax * rate), 'ğŸ’°')}` : '';
        document.getElementById('statMaxPrice').innerHTML = [maxCoinText, maxCrystalText].filter(Boolean).join('<br>') || '-';
    } else {
        // å–®ä¸€å¹£ç¨®æ¨¡å¼ï¼ˆåŸæœ‰é‚è¼¯ï¼‰
        const priceType = currency === '1' ? 1 : 0;
        const prices = items
            .filter(i => i.pricetype === priceType)
            .map(i => i.price);
        
        document.getElementById('statMinPrice').textContent = prices.length ? Math.min(...prices).toLocaleString() : '-';
        document.getElementById('statMaxPrice').textContent = prices.length ? Math.max(...prices).toLocaleString() : '-';
        document.getElementById('statAvgPrice').textContent = prices.length ? calcTrimmedAvg(prices).toLocaleString() : '-';
    }
    
    document.getElementById('statsGrid').style.display = 'grid';
}

/* ========================================
   UI è¼”åŠ©
======================================== */
async function switchTab(tab) {
    currentTab = tab;
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.querySelector(`.tab[data-tab="${tab}"]`).classList.add('active');
    
    document.getElementById('marketSection').style.display = tab === 'market' ? 'block' : 'none';
    document.getElementById('historySection').style.display = tab === 'history' ? 'block' : 'none';
    document.getElementById('statsGrid').style.display = tab === 'market' ? 'grid' : 'none';
    
    // åˆ‡æ›åˆ°æ­·å²æˆäº¤æ™‚ï¼Œå¦‚æœé‚„æ²’æœ‰è³‡æ–™å°±è‡ªå‹•æœå°‹
    if (tab === 'history' && allHistoryLogs.length === 0) {
        const keyword = document.getElementById('searchInput').value.trim();
        if (keyword) {
            showLoading(true);
            document.getElementById('historySection').style.display = 'none';
            try {
                allHistoryLogs = await fetchHistoryData(keyword);
                if (allHistoryLogs.length > 0) {
                    renderHistoryData();
                    document.getElementById('historySection').style.display = 'block';
                } else {
                    showEmpty('æ‰¾ä¸åˆ°æ­·å²æˆäº¤è¨˜éŒ„');
                }
            } catch (err) {
                console.error(err);
                showEmpty('æœå°‹æ­·å²å¤±æ•—');
            } finally {
                showLoading(false);
            }
        }
    }
}

function showLoading(show) {
    document.getElementById('loading').style.display = show ? 'block' : 'none';
}

function hideAll() {
    document.getElementById('emptyState').style.display = 'none';
    document.getElementById('marketSection').style.display = 'none';
    document.getElementById('historySection').style.display = 'none';
    document.getElementById('statsGrid').style.display = 'none';
}

function showEmpty(msg) {
    document.getElementById('emptyState').innerHTML = `
        <div class="icon">ğŸ˜¢</div>
        <div>${msg}</div>
    `;
    document.getElementById('emptyState').style.display = 'block';
}

function escapeHtml(str) {
    if (!str) return '';
    return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;');
}

function calcTrimmedAvg(arr) {
    if (!arr.length) return 0;
    if (arr.length <= 2) {
        return Math.floor(arr.reduce((a, b) => a + b, 0) / arr.length);
    }
    const sorted = [...arr].sort((a, b) => a - b);
    const start = Math.floor(sorted.length * 0.1);
    const end = Math.ceil(sorted.length * 0.9);
    const trimmed = sorted.slice(start, end);
    return Math.floor(trimmed.reduce((a, b) => a + b, 0) / trimmed.length);
}
</script>

</body>
</html>

